{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/eev/eev.js","webpack:///./src/devices/gamepad/controlMap.js","webpack:///./src/util/runProcessors.js","webpack:///./src/util/copyOptions.js","webpack:///./src/controls/InputControl.js","webpack:///./src/controls/AxisInputControl.js","webpack:///./src/controls/ButtonInputControl.js","webpack:///./src/controls/Vector2InputControl.js","webpack:///./src/processors/axisDeadZone.js","webpack:///./src/processors/stickDeadZone.js","webpack:///./src/controls/StickInputControl.js","webpack:///./src/devices/gamepad/index.js","webpack:///./src/util/boolAsNum.js","webpack:///./src/devices/pointer/index.js","webpack:///./src/controls/DPadComposite.js","webpack:///./src/controls/AxisComposite.js","webpack:///./src/interactions/Interaction.js","webpack:///./src/Action.js","webpack:///./src/interactions/PressInteraction.js","webpack:///./src/interactions/ReleaseInteraction.js","webpack:///./src/devices/virtualjoystick/index.js","webpack:///./src/devices/virtualjoystick/DOMRenderer.js","webpack:///./examples/simple.js","webpack:///./src/devices/keyboard/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","factory","define","Eev","id","splitter","LinkedList","linkConstructor","this","head","RunnableLink","tail","next","reg","prev","fn","noop","events","insert","data","link","remove","run","constructor","on","names","me","split","forEach","list","eev","_eev","off","undefined","emit","evt","amd","buttonIndexes","dpadUp","dpadDown","dpadLeft","dpadRight","L1","L2","L3","R1","R2","R3","A","B","X","Y","start","select","home","buttons","keys","sticks","reduce","runProcessors","processors","initialValue","copyOptions","dest","src","InputControl","read","options","Map","length","path","indexOf","k","substring","child","children","find","defaultValue","val","Math","abs","AxisInputControl","axis","ButtonInputControl","opts","magnitude","pressPoint","Vector2InputControl","vector2","x","parent","y","set","vec","hypot","axisDeadZone","min","max","absValue","sign","stickDeadZone","newMagnitude","scale","makeChild","negative","neg","rawAxisValue","mag","getChildValue","childbuttons","StickInputControl","standardControlNames","Set","add","readers","device","buttonIndex","leftAxisIndex","axes","axisIndex","Gamepad","index","updatePeriod","controlDefs","controlIndices","lastDevice","lastDeviceUpdate","update","navigator","getGamepads","timestamp","performance","now","buttonName","stickName","onConnected","gp","gamepad","onDisconnected","def","has","delete","getControl","ControlConstructor","Error","reader","controls","destroy","window","removeEventListener","defineProperties","connected","addEventListener","boolAsNum","buttonDefs","mouse","touch","pen","buttonNames","getButtonName","button","isPrimary","pointerType","values","position","pagePosition","pageX","pageY","screenPosition","screenX","screenY","tilt","contact","width","height","delta","previousEvent","pageDelta","screenDelta","pressure","DPadInputControl","left","right","up","down","AxisComposite","positive","Interaction","binding","control","Date","defaultInteraction","Action","bindings","interactions","interactionStack","destroyed","enabled","activeBinding","activeTime","state","transitionState","nextState","push","event","clearInteractions","interaction","reset","processInteraction","stackIndex","findIndex","iState","newState","process","unbind","splice","previousBinding","best","Infinity","controlValue","interactionBinding","interacted","shift","activeControl","apply","PressInteraction","ReleaseInteraction","pressed","wasPressed","VirtualJoystick","element","document","body","radius","lockX","lockY","filter","touchActionStyle","startEvent","lastEvent","startX","startY","deltaX","deltaY","isStatic","supported","maxTouchPoints","allowedPointerTypes","pointerDown","dx","offsetX","dy","offsetY","pointerMove","pointerId","divisor","pointerUp","styleElement","style","touchAction","configurable","writable","timeStamp","DOMRenderer","innerRadius","parentElement","outer","createElement","pointerEvents","borderRadius","transition","backgroundColor","inner","appendChild","rafId","render","outerSize","ox","oy","top","opacity","innerSize","requestAnimationFrame","cancelAnimationFrame","parentNode","removeChild","leftStick","rightStickHoriz","kbd","keysDown","onKeyDown","toLowerCase","onKeyUp","readAnyKey","size","readSingleKey","readFilterKey","readArrayKey","some","Array","isArray","String","clear","kbdWASD","DPadComposite","pointer","lastWheelEvent","buttonsDown","saveEvent","mask","buttonDown","onWheel","readButton","controlSpec","rotateArrowKeys","leftTouchJoystick","innerWidth","rightTouchJoystick","moveAction","rotateAction","buttonAction","console","log","thing","margin","last","dr","motionScale","transform"],"mappings":"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","file":"examples/simple-f35b535ae3c446ed603a.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/game-input/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","\nvar Eev = (function () {\n  var id = 0;\n  var splitter = /[\\s,]+/g;\n\n  // A relatively generic LinkedList impl\n  function LinkedList(linkConstructor) {\n    this.head = new RunnableLink();\n    this.tail = new RunnableLink(this.head);\n    this.head.next = this.tail;\n    this.linkConstructor = linkConstructor;\n    this.reg = {};\n  }\n\n  LinkedList.prototype = {\n    insert: function (data) {\n      var link = new RunnableLink(this.tail.prev, this.tail, data);\n      link.next.prev = link.prev.next = link;\n      return link;\n    },\n\n    remove: function (link) {\n      link.prev.next = link.next;\n      link.next.prev = link.prev;\n    }\n  };\n\n  // A link in the linked list which allows\n  // for efficient execution of the callbacks\n  function RunnableLink(prev, next, fn) {\n    this.prev = prev;\n    this.next = next;\n    this.fn = fn || noop;\n  }\n\n  RunnableLink.prototype.run = function (data) {\n    this.fn(data);\n    this.next && this.next.run(data);\n  };\n\n  function noop () { }\n\n  function Eev () {\n    this.events = {};\n  }\n\n  Eev.prototype = {\n    constructor: Eev,\n\n    on: function (names, fn) {\n      var me = this;\n\n      names.split(splitter).forEach(function (name) {\n        var list = me.events[name] || (me.events[name] = new LinkedList());\n        var eev = fn._eev || (fn._eev = (++id));\n\n        list.reg[eev] || (list.reg[eev] = list.insert(fn));\n      });\n    },\n\n    off: function (names, fn) {\n      var me = this;\n      fn && names.split(splitter).forEach(function (name) {\n        var list = me.events[name];\n\n        if (!list) {\n          return;\n        }\n\n        var link = list.reg[fn._eev];\n\n        list.reg[fn._eev] = undefined;\n\n        list && link && list.remove(link);\n      });\n    },\n\n    emit: function (name, data) {\n      var evt = this.events[name];\n      evt && evt.head.run(data);\n    }\n  };\n\n  return Eev;\n}());\n\n// AMD/CommonJS support\n(function (root, factory) {\n  var define = root.define;\n\n  if (define && define.amd) {\n    define([], factory);\n  } else if (typeof module !== 'undefined' && module.exports) {\n    module.exports = factory();\n  }\n}(this, function () { return Eev; }));\n","const buttonIndexes = {\n\tdpadUp: 12,\n\tdpadDown: 13,\n\tdpadLeft: 14,\n\tdpadRight: 15,\n\tL1: 4,\n\tL2: 6,\n\tL3: 10,\n\tR1: 5,\n\tR2: 7,\n\tR3: 11,\n\tA: 0,\n\tB: 1,\n\tX: 2,\n\tY: 3,\n\tstart: 9,\n\tselect: 8,\n\thome: 16\n};\nconst buttons = [];\nObject.keys(buttonIndexes).forEach(key => {\n\tbuttons[buttonIndexes[key]] = key;\n});\n\nconst axes = [\n\t'leftStickX',\n\t'leftStickY',\n\t'rightStickX',\n\t'rightStickY'\n];\n\nconst sticks = [\n\t'leftStick',\n\t'rightStick'\n];\n\nexport {\n\tbuttons,\n\tbuttonIndexes,\n\taxes,\n\tsticks\n};\n","const reduce = (prev, fn) => fn(prev);\n\nexport default function runProcessors(processors, initialValue) {\n\treturn processors.reduce(reduce, initialValue);\n}\n","export default function copyOptions(dest, src) {\n\tif (!src) {\n\t\treturn;\n\t}\n\tObject.keys(dest).forEach(key => {\n\t\tif (key in src && typeof dest[key] !== 'function') {\n\t\t\tdest[key] = src[key];\n\t\t}\n\t});\n}\n\n","import runProcessors from '../util/runProcessors';\nimport copyOptions from '../util/copyOptions';\n\nexport default class InputControl {\n\tstatic defaultValue = 0;\n\n\tname = '';\n\tparent = null;\n\tchildren = new Map();\n\tdevice = null;\n\tprocessors = [];\n\n\tconstructor(read, options) {\n\t\tcopyOptions(this, options);\n\t\tthis.read = this.processors.length ?\n\t\t\t() => runProcessors(this.processors, read()) :\n\t\t\tread || this.read;\n\t}\n\n\tfind(path) {\n\t\tif (!path) {\n\t\t\treturn this;\n\t\t}\n\n\t\tconst i = path.indexOf('/');\n\t\tif (i > 0) {\n\t\t\tconst k = path.substring(0, i);\n\t\t\tconst child = this.children.get(k);\n\t\t\tif (child) {\n\t\t\t\treturn child.find(path.substring(k + 1));\n\t\t\t}\n\t\t}\n\n\t\treturn this.children.get(path) || null;\n\t}\n\n\tread() {\n\t\treturn this.prototype.defaultValue;\n\t}\n\n\tmagnitude(val = this.read()) {\n\t\treturn Math.abs(val);\n\t}\n}\n","import InputControl from './InputControl';\n\nexport default class AxisInputControl extends InputControl {\n\tconstructor(read = () => 0, options) {\n\t\tsuper(read, options);\n\t\tthis.axis = this.read;\n\t}\n}\n","import AxisInputControl from './AxisInputControl';\nimport copyOptions from '../util/copyOptions';\n\nexport default class ButtonInputControl extends AxisInputControl {\n\tpressPoint = 0.5;\n\tconstructor(read, opts) {\n\t\tsuper(read, opts);\n\t\tcopyOptions(this, opts);\n\t}\n\n\tpressed(value = this.magnitude()) {\n\t\treturn value >= this.pressPoint;\n\t}\n}\n","import InputControl from './InputControl';\nimport AxisInputControl from './AxisInputControl';\n\nexport default class Vector2InputControl extends InputControl {\n\tstatic defaultValue = [0, 0];\n\n\tconstructor(read, options) {\n\t\tsuper(read, options);\n\n\t\tthis.vector2 = this.read;\n\t\tthis.x = new AxisInputControl(() => this.read()[0], Object.assign({}, options && options.x, {\n\t\t\tparent: this\n\t\t}));\n\n\t\t// i don't know why this is negative, but it is\n\t\tthis.y = new AxisInputControl(() => this.read()[1], Object.assign({}, options && options.y, {\n\t\t\tparent: this\n\t\t}));\n\t\tthis.children.set('x', this.x);\n\t\tthis.children.set('y', this.x);\n\t}\n\n\tmagnitude(vec = this.read()) {\n\t\treturn Math.hypot(vec[0], vec[1]);\n\t}\n}\n","export default function axisDeadZone(value, min = 0.125, max = 0.925) {\n\tconst absValue = Math.abs(value);\n\tif (absValue < min) {\n\t\treturn 0;\n\t}\n\tif (absValue > max) {\n\t\treturn Math.sign(value);\n\t}\n\n\treturn Math.sign(value) * (absValue - min) / (max - min);\n}\n","import axisDeadZone from './axisDeadZone';\n\nexport default function stickDeadZone(value, min, max) {\n\tconst [x, y] = value;\n\tconst magnitude = Math.hypot(x, y);\n\tconst newMagnitude = axisDeadZone(magnitude, min, max);\n\n\tif (newMagnitude === 0) {\n\t\treturn [0, 0];\n\t}\n\n\tconst scale = newMagnitude / magnitude;\n\treturn [x * scale, y * scale];\n}\n","import Vector2InputControl from './Vector2InputControl';\nimport ButtonInputControl from './ButtonInputControl';\nimport stickDeadZone from '../processors/stickDeadZone';\n\nfunction getChildValue(read, axis, neg) {\n\tconst vec = read();\n\tconst rawAxisValue = vec[axis];\n\tconst mag = Math.abs(neg ? -rawAxisValue : rawAxisValue);\n\treturn Math.max(0, mag);\n}\n\nfunction makeChild(parent, name, axis, negative, options) {\n\tconst opts = Object.assign({}, options && options[name], {\n\t\tparent\n\t});\n\tparent[name] = new ButtonInputControl(() => getChildValue(axis, negative), opts);\n\n\tparent.children.set(name, parent[name]);\n}\n\nconst childbuttons = [\n\t['left', 0, true],\n\t['right', 0, false],\n\t['down', 1, true],\n\t['up', 1, false]\n];\n\nexport default class StickInputControl extends Vector2InputControl {\n\tconstructor(read, options) {\n\t\tsuper(read, Object.assign(\n\t\t\t{\n\t\t\t\tprocessors: [stickDeadZone]\n\t\t\t},\n\t\t\toptions\n\t\t));\n\n\t\tchildbuttons.forEach(([name, axis, negative]) => {\n\t\t\tmakeChild(this, name, axis, negative, options);\n\t\t});\n\t}\n}\n","import {\n\tbuttons,\n\tsticks\n} from './controlMap';\nimport ButtonInputControl from '../../controls/ButtonInputControl';\nimport StickInputControl from '../../controls/StickInputControl';\nimport AxisInputControl from '../../controls/AxisInputControl';\nimport eev from 'eev';\n\nconst standardControlNames = new Set(buttons);\nsticks.forEach(n => standardControlNames.add(n));\n\nconst readers = new Map([\n\t[ButtonInputControl, (device, buttonIndex) => device.buttons[buttonIndex].value],\n\t[StickInputControl, (device, leftAxisIndex) => [\n\t\tdevice.axes[leftAxisIndex],\n\t\t-device.axes[leftAxisIndex + 1]\n\t]],\n\t[AxisInputControl, (device, axisIndex) => device.axes[axisIndex]]\n]);\n\nexport default function Gamepad(index = 0, {\n\tupdatePeriod = 1000 / 120\n} = {}) {\n\teev.call(this);\n\n\tconst controlDefs = new Map();\n\tconst controlIndices = new Map();\n\tlet lastDevice = null;\n\tlet lastDeviceUpdate = 0;\n\n\tbuttons.forEach((buttonName, i) => {\n\t\tcontrolDefs.set(buttonName, ButtonInputControl);\n\t\tcontrolIndices.set(buttonName, i);\n\t});\n\n\tsticks.forEach((stickName, i) => {\n\t\tcontrolDefs.set(stickName, StickInputControl);\n\t\tcontrolIndices.set(stickName, i * 2);\n\t});\n\n\tfunction update() {\n\t\tconst device = navigator.getGamepads()[index];\n\t\tconst timestamp = device && device.timestamp || performance.now();\n\t\tif (device && timestamp - lastDeviceUpdate >= updatePeriod) {\n\t\t\tlastDevice = device;\n\t\t\tlastDeviceUpdate = timestamp;\n\t\t}\n\t}\n\n\tconst onConnected = evt => {\n\t\tconst gp = evt.gamepad;\n\t\tif (gp.index === index) {\n\t\t\tupdate();\n\n\t\t\t// set any additional buttons or axes\n\t\t\tfor (let i = buttons.length; i < gp.buttons.length; i++) {\n\t\t\t\tconst name = 'button' + i;\n\t\t\t\tcontrolDefs.set(name, ButtonInputControl);\n\t\t\t\tcontrolIndices.set(name, i);\n\t\t\t}\n\n\t\t\tfor (let i = 4; i < gp.axes.length; i++) {\n\t\t\t\tconst name = 'axis' + i;\n\t\t\t\tcontrolDefs.set(name, AxisInputControl);\n\t\t\t\tcontrolIndices.set(name, i);\n\t\t\t}\n\n\t\t\tthis.emit('connected');\n\t\t}\n\t};\n\n\tconst onDisconnected = evt => {\n\t\tconst gp = evt.gamepad;\n\t\tif (gp.index === index) {\n\t\t\t// remove any extra controls\n\t\t\tcontrolDefs.forEach((def, key) => {\n\t\t\t\tif (!standardControlNames.has(key)) {\n\t\t\t\t\tcontrolDefs.delete(key);\n\t\t\t\t\tcontrolIndices.delete(key);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.emit('disconnected');\n\t\t}\n\t};\n\n\tthis.getControl = (name, options) => {\n\t\tconst ControlConstructor = controlDefs.get(name);\n\t\tif (!ControlConstructor) {\n\t\t\tthrow new Error('Control not found');\n\t\t}\n\n\t\tconst reader = readers.get(ControlConstructor);\n\t\tconst index = controlIndices.get(name);\n\t\tconst read = () => {\n\t\t\tupdate();\n\t\t\treturn lastDevice ?\n\t\t\t\treader(lastDevice, index) :\n\t\t\t\tControlConstructor.defaultValue;\n\t\t};\n\n\t\treturn new ControlConstructor(read, Object.assign({\n\t\t\tname\n\t\t}, options, {\n\t\t\tdevice: this\n\t\t}));\n\t};\n\n\tthis.controls = () => controlDefs.keys();\n\n\tthis.destroy = () => {\n\t\t// todo: clean out event listeners\n\t\twindow.removeEventListener('gamepadconnected', onConnected);\n\t\twindow.removeEventListener('gamepaddisconnected', onDisconnected);\n\t};\n\n\tObject.defineProperties(this, {\n\t\tdevice: {\n\t\t\tget: () => lastDevice\n\t\t},\n\t\tid: {\n\t\t\tget: () => lastDevice && lastDevice.id || null\n\t\t},\n\t\tconnected: {\n\t\t\tget: () => !!lastDevice && lastDevice.connected\n\t\t},\n\t\ttimestamp: {\n\t\t\tget: () => lastDeviceUpdate\n\t\t}\n\t});\n\n\tupdate();\n\twindow.addEventListener('gamepadconnected', onConnected);\n\twindow.addEventListener('gamepaddisconnected', onDisconnected);\n}\n\nGamepad.prototype = Object.create(eev.prototype);\n","const boolAsNum = fn => () => fn() ? 1 : 0;\nexport default boolAsNum;\n","import ButtonInputControl from '../../controls/ButtonInputControl';\nimport AxisInputControl from '../../controls/AxisInputControl';\nimport Vector2InputControl from '../../controls/Vector2InputControl';\nimport boolAsNum from '../../util/boolAsNum';\n\nconst buttonDefs = [\n\t{\n\t\tmouse: 'leftMouseButton',\n\t\ttouch: 'touch',\n\t\tpen: 'penTip'\n\t},\n\t{\n\t\tmouse: 'middleMouseButton'\n\t},\n\t{\n\t\tmouse: 'rightMouseButton',\n\t\tpen: 'penBarrelButton'\n\t},\n\t{\n\t\tmouse: 'mouseBackButton'\n\t},\n\t{\n\t\tmouse: 'mouseForwardButton'\n\t},\n\t{\n\t\tpen: 'penEraser'\n\t}\n];\n\nconst buttonNames = new Set();\nbuttonDefs.forEach(def => {\n\tfor (const buttonName of Object.values(def)) {\n\t\tbuttonNames.add(buttonName);\n\t}\n});\n\nfunction getButtonName(evt, buttonIndex = evt.button) {\n\tif (buttonIndex >= 0 && buttonIndex < buttonDefs.length && evt.isPrimary) {\n\t\tconst def = buttonDefs[buttonIndex];\n\t\treturn def[evt.pointerType] || '';\n\t}\n\n\treturn '';\n}\n\nconst controlDefs = {\n\tposition: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.x, evt.y]\n\t},\n\tpagePosition: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.pageX, evt.pageY]\n\t},\n\tscreenPosition: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.screenX, evt.screenY]\n\t},\n\ttilt: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.screenX / 90, evt.screenY / 90]\n\t},\n\tcontact: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.width, evt.height]\n\t},\n\tdelta: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: (evt, previousEvent, defaultValue) => previousEvent ?\n\t\t\t[evt.x - previousEvent.x, evt.y - previousEvent.y] :\n\t\t\tdefaultValue\n\t},\n\tpageDelta: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: (evt, previousEvent, defaultValue) => previousEvent ?\n\t\t\t[evt.pageX - previousEvent.pageX, evt.pageY - previousEvent.pageY] :\n\t\t\tdefaultValue\n\t},\n\tscreenDelta: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: (evt, previousEvent, defaultValue) => previousEvent ?\n\t\t\t[evt.screenX - previousEvent.screenX, evt.screenY - previousEvent.screenY] :\n\t\t\tdefaultValue\n\t},\n\tpressure: {\n\t\tconstructor: AxisInputControl,\n\t\treader: evt => evt.pressure || 0\n\t}\n};\n\n/*\nFor now, this only allows for a single, primary device\n\ntodo:\n- option to specify device by index/pointerId\n- option to filter by device type\n- how do we handle multiple pointers at a time, like touch?\n  https://devdocs.io/dom/pointer_events/multi-touch_interaction\n  `navigator.maxTouchPoints`\n- pinch/zoom\n  https://devdocs.io/dom/pointer_events/pinch_zoom_gestures\n- detect available devices (static method?)\n- we could certainly use adjustable sensitivity/scaling values\n  or I guess that could be done by a Processor\n*/\n\nexport default function Pointer({\n\tupdatePeriod = 1000 / 60,\n\ttouch = true,\n\tpen = true,\n\tmouse = true\n} = {}) {\n\tlet previousEvent = null;\n\tlet lastEvent = null;\n\tlet lastWheelEvent = null;\n\n\tconst allowedPointerTypes = {\n\t\tpen,\n\t\tmouse,\n\t\ttouch\n\t};\n\n\tconst buttonsDown = new Set();\n\n\tconst saveEvent = evt => {\n\t\tif (evt.isPrimary && allowedPointerTypes[evt.pointerType]) {\n\t\t\tpreviousEvent = lastEvent;\n\t\t\tlastEvent = evt;\n\n\t\t\tfor (let i = 0; i < buttonDefs.length; i++) {\n\t\t\t\t/* eslint-disable no-bitwise */\n\t\t\t\tconst mask = 1 << i;\n\t\t\t\tconst buttonDown = evt.buttons & mask;\n\t\t\t\t/* eslint-enable no-bitwise */\n\t\t\t\tconst name = getButtonName(evt, i);\n\t\t\t\tif (buttonDown) {\n\t\t\t\t\tbuttonsDown.add(name);\n\t\t\t\t} else {\n\t\t\t\t\tbuttonsDown.delete(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onWheel = evt => {\n\t\tlastWheelEvent = evt;\n\t};\n\n\tfunction update() {\n\t\tif (lastEvent && performance.now() - lastEvent.timeStamp > updatePeriod) {\n\t\t\tpreviousEvent = lastEvent;\n\t\t}\n\n\t\tif (lastWheelEvent && performance.now() - lastWheelEvent.timeStamp > updatePeriod) {\n\t\t\tlastWheelEvent = null;\n\t\t}\n\t}\n\n\tfunction readButton(name) {\n\t\treturn buttonsDown.has(name.toLowerCase());\n\t}\n\n\tthis.getControl = (name, options = {}) => {\n\t\tconst controlSpec = controlDefs[name];\n\t\tif (controlSpec) {\n\t\t\tconst {\n\t\t\t\tconstructor: ControlConstructor,\n\t\t\t\treader\n\t\t\t} = controlSpec;\n\n\t\t\tconst read = () => {\n\t\t\t\tupdate();\n\t\t\t\treturn lastEvent ?\n\t\t\t\t\treader(lastEvent, previousEvent, ControlConstructor.defaultValue) :\n\t\t\t\t\tControlConstructor.defaultValue;\n\t\t\t};\n\n\t\t\treturn new ControlConstructor(read, Object.assign({\n\t\t\t\tname\n\t\t\t}, options, {\n\t\t\t\tdevice: this\n\t\t\t}));\n\t\t}\n\n\t\tif (buttonNames.has(name)) {\n\t\t\treturn new ButtonInputControl(boolAsNum(() => readButton(name)), Object.assign({\n\t\t\t\tname\n\t\t\t}, options));\n\t\t}\n\n\t\t/*\n\t\tAccording to the spec, delta values can vary by deltaMode, but\n\t\tit seems that all browsers currently report values in pixels\n\t\t*/\n\t\tif (name === 'wheel') {\n\t\t\treturn new Vector2InputControl(\n\t\t\t\t() => {\n\t\t\t\t\tupdate();\n\t\t\t\t\treturn lastWheelEvent ?\n\t\t\t\t\t\t[lastWheelEvent.deltaX, lastWheelEvent.deltaY] :\n\t\t\t\t\t\tVector2InputControl.defaultValue;\n\t\t\t\t},\n\t\t\t\tObject.assign({\n\t\t\t\t\tname\n\t\t\t\t}, options, {\n\t\t\t\t\tdevice: this\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tthrow new Error('Control not found');\n\t};\n\n\tthis.destroy = () => {\n\t\tbuttonsDown.clear();\n\t\twindow.removeEventListener('pointerdown', saveEvent);\n\t\twindow.removeEventListener('pointerup', saveEvent);\n\t\twindow.removeEventListener('pointermove', saveEvent);\n\t\twindow.removeEventListener('wheel', onWheel);\n\t};\n\n\tObject.defineProperties(this, {\n\t\tpointerType: {\n\t\t\tget: () => lastEvent && lastEvent.pointerType || ''\n\t\t},\n\n\t\t// assume pointer is always connected?\n\t\t// ...not necessarily\n\t\tconnected: {\n\t\t\tenumerable: false,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tvalue: true\n\t\t},\n\t\ttimestamp: {\n\t\t\tget: () => lastEvent && lastEvent.timeStamp || 0\n\t\t}\n\t});\n\n\twindow.addEventListener('pointerdown', saveEvent);\n\twindow.addEventListener('pointerup', saveEvent);\n\twindow.addEventListener('pointermove', saveEvent);\n\twindow.addEventListener('wheel', onWheel);\n}\n","import Vector2InputControl from './Vector2InputControl';\n\nexport default class DPadInputControl extends Vector2InputControl {\n\tconstructor({\n\t\tleft,\n\t\tright,\n\t\tup,\n\t\tdown,\n\t\t...opts\n\t}) {\n\t\tconst read = () => {\n\t\t\tconst x = (right.read() - left.read()) / 2;\n\t\t\tconst y = (up.read() - down.read()) / 2;\n\t\t\treturn [x, y];\n\t\t};\n\t\tsuper(read, opts);\n\n\t\tthis.children.set('left', left);\n\t\tthis.children.set('right', right);\n\t\tthis.children.set('up', up);\n\t\tthis.children.set('down', down);\n\t}\n}\n","import AxisInputControl from './AxisInputControl';\nimport axisDeadZone from '../processors/axisDeadZone';\n\nexport default class AxisComposite extends AxisInputControl {\n\tconstructor({\n\t\tnegative,\n\t\tpositive,\n\t\t...opts\n\t}) {\n\t\tconst read = () => {\n\t\t\tconst neg = negative.read();\n\t\t\tconst pos = positive.read();\n\t\t\treturn (pos - neg) / 2;\n\t\t};\n\t\tsuper(read, Object.assign(\n\t\t\t{\n\t\t\t\tprocessors: [axisDeadZone]\n\t\t\t},\n\t\t\topts\n\t\t));\n\n\t\tthis.children.set('negative', negative);\n\t\tthis.children.set('positive', positive);\n\t}\n}\n","export default class Interaction {\n\tprocess(binding/*, action*/) {\n\t\treturn binding.control.magnitude() > 0 ? 'complete' : 'inactive';\n\t}\n\n\treset() {}\n}\n","import eev from 'eev';\nimport runProcessors from './util/runProcessors';\nimport InputControl from './controls/InputControl';\nimport Interaction from './interactions/Interaction';\n\n/*\ntodo: use something like hrtime or performance.now in node.js\n*/\nconst now = typeof performance === undefined ?\n\t() => performance.now() : // eslint-disable-line no-undef\n\t() => Date.now();\n\n/*\ntodo: give everything ids so we can reference them later.\nprobably.\n*/\nconst defaultInteraction = new Interaction();\n\nexport default function Action(options = {}) {\n\teev.call(this);\n\tconst me = this;\n\n\tthis.name = options.name || '';\n\n\tconst bindings = [];\n\tconst processors = [];\n\tconst interactions = [];\n\tconst interactionStack = [];\n\n\tlet destroyed = false;\n\tlet enabled = true;\n\tlet activeBinding = null;\n\tlet activeTime = 0;\n\tlet state = 'inactive';\n\tlet value;\n\n\tthis.bindings = bindings;\n\tthis.processors = processors;\n\tthis.interactions = interactions;\n\n\t/*\n\tstates\n\t- inactive\n\t  - => active: started\n\t  - => complete: started, completed\n\t- active\n\t  - => complete: completed\n\t  - => inactive: canceled, ended\n\t- complete\n\t  - => inactive: ended\n\t*/\n\tconst transitionState = (nextState, binding) => {\n\t\tif (nextState === state || !enabled) { // todo: and binding hasn't changed\n\t\t\treturn;\n\t\t}\n\n\t\tif (nextState === 'active' && state === 'complete') {\n\t\t\t// stay right where we are\n\t\t\treturn;\n\t\t}\n\n\t\tconst events = [];\n\n\t\tif (nextState === 'complete') {\n\t\t\ttransitionState('active', binding);\n\t\t\tevents.push('completed');\n\t\t} else if (nextState === 'inactive') {\n\t\t\tif (state !== 'complete') {\n\t\t\t\tevents.push('canceled');\n\t\t\t}\n\t\t\tevents.push('ended');\n\t\t} else if (nextState === 'active') {\n\t\t\tevents.push('started');\n\t\t} else {\n\t\t\tthrow new Error('Unsupported state: ' + nextState);\n\t\t}\n\n\t\tstate = nextState;\n\t\tevents.forEach(event => this.emit(event, binding));\n\t};\n\n\tfunction clearInteractions() {\n\t\tinteractionStack.forEach(({ interaction }) => interaction.reset());\n\t\tinteractionStack.length = 0;\n\t}\n\n\tfunction processInteraction(binding, interaction) {\n\t\tlet stackIndex = interactionStack.findIndex(\n\t\t\tiState => iState.binding === binding && iState.interaction === interaction\n\t\t);\n\t\tlet iState = stackIndex >= 0 && interactionStack[stackIndex];\n\n\t\tconst newState = interaction.process(binding, me) ||\n\t\t\tiState && iState.state ||\n\t\t\t'inactive';\n\n\t\tif (stackIndex < 0 && newState !== 'inactive') {\n\t\t\tstackIndex = interactionStack.length;\n\t\t\tiState = {\n\t\t\t\tbinding,\n\t\t\t\tinteraction,\n\t\t\t\tstate: 'inactive'\n\t\t\t};\n\t\t\tinteractionStack.push(iState);\n\t\t}\n\t\tif (iState) {\n\t\t\tiState.state = newState;\n\t\t}\n\t}\n\n\t/*\n\ttodo: we need better CRUD methods for bindings, processors and interactions\n\t*/\n\tthis.bind = (control, options) => {\n\t\tif (!options && !(control instanceof InputControl)) {\n\t\t\toptions = control;\n\t\t}\n\t\tif (options && options.control) {\n\t\t\tcontrol = options.control;\n\t\t}\n\n\t\tif (!(control instanceof InputControl)) {\n\t\t\t// could we do this by duck-typing?\n\t\t\tthrow new Error('Binding requires an InputControl');\n\t\t}\n\n\t\tconst binding = {\n\t\t\tcontrol,\n\t\t\tprocessors: options && options.processors,\n\t\t\tinteractions: options && options.interactions\n\t\t};\n\t\tbindings.push(binding);\n\t\treturn bindings.length - 1;\n\t};\n\n\tthis.unbind = index => {\n\t\tif (index < bindings.length) {\n\t\t\tconst binding = bindings.splice(index, 1);\n\t\t\tif (binding === activeBinding) {\n\t\t\t\t// todo: reset state\n\t\t\t}\n\n\t\t\t// todo: clear binding from queue\n\t\t}\n\t};\n\n\tthis.update = () => {\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousBinding = activeBinding;\n\t\tactiveBinding = null;\n\n\t\tlet best = -Infinity;\n\t\tfor (let i = 0; i < bindings.length; i++) {\n\t\t\tconst binding = bindings[i];\n\t\t\tconst { control } = binding;\n\t\t\tconst controlValue = binding.processors ?\n\t\t\t\trunProcessors(binding.processors, control.read()) :\n\t\t\t\tcontrol.read();\n\t\t\tconst magnitude = control.magnitude(controlValue);\n\t\t\tif (magnitude > best) {\n\t\t\t\tvalue = controlValue;\n\t\t\t\tbest = magnitude;\n\t\t\t\tif (magnitude > 0) {\n\t\t\t\t\tactiveBinding = binding;\n\t\t\t\t\tif (!activeTime) {\n\t\t\t\t\t\tactiveTime = now();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!activeBinding) {\n\t\t\tactiveTime = 0;\n\t\t}\n\n\t\t// should processor happen before disambiguation?\n\t\tif (value !== undefined) {\n\t\t\tvalue = runProcessors(processors, value);\n\t\t}\n\n\t\t// interactions, events\n\t\tconst interactionBinding = activeBinding || previousBinding;\n\t\tlet interacted = interactions.length > 0;\n\t\tif (interactionBinding && interactionBinding.interactions) {\n\t\t\tinteracted = interacted || interactionBinding.interactions.length > 0;\n\t\t\tinteractionBinding.interactions.forEach(\n\t\t\t\tinteraction => processInteraction(interactionBinding, interaction)\n\t\t\t);\n\t\t}\n\n\t\t// todo: this will not catch deactivated controls that need to be processed\n\t\t// we need to re-think this whole flow\n\t\tif (interactionBinding) {\n\t\t\tinteractions.forEach(\n\t\t\t\tinteraction => processInteraction(interactionBinding, interaction)\n\t\t\t);\n\t\t}\n\n\t\tif (interactionBinding && !interacted) {\n\t\t\tprocessInteraction(interactionBinding, defaultInteraction);\n\t\t}\n\n\t\twhile (interactionStack.length) {\n\t\t\tconst iState = interactionStack[0];\n\t\t\tif (iState.state === 'inactive') {\n\t\t\t\tinteractionStack.shift();\n\t\t\t\tiState.interaction.reset();\n\t\t\t\ttransitionState(iState.state, iState.binding);\n\t\t\t} else {\n\t\t\t\tif (iState.state === 'complete') {\n\t\t\t\t\tclearInteractions();\n\t\t\t\t\ttransitionState('complete', iState.binding);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!interactionStack.length) {\n\t\t\t// resetInteractions();\n\t\t\ttransitionState('inactive');\n\t\t}\n\t};\n\n\tthis.destroy = () => {\n\t\tdestroyed = true;\n\t\tenabled = false;\n\t\tclearInteractions();\n\t\ttransitionState('inactive');\n\t\tstate = 'destroyed';\n\t};\n\n\tObject.defineProperties(this, {\n\t\tenabled: {\n\t\t\tset(val) {\n\t\t\t\tval = !!val;\n\t\t\t\tif (val !== enabled && !destroyed) {\n\t\t\t\t\tenabled = val;\n\t\t\t\t\ttransitionState('inactive');\n\t\t\t\t\tstate = enabled ? 'inactive' : 'disabled';\n\t\t\t\t\tclearInteractions();\n\t\t\t\t}\n\t\t\t},\n\t\t\tget: () => enabled\n\t\t},\n\t\tactiveControl: {\n\t\t\tget: () => activeBinding && activeBinding.control\n\t\t},\n\t\tstate: {\n\t\t\tget: () => state\n\t\t},\n\t\tvalue: {\n\t\t\tget: () => value\n\t\t}\n\t});\n\n\tif (options.bindings) {\n\t\toptions.bindings.forEach(binding => {\n\t\t\tthis.bind(binding);\n\t\t});\n\t}\n\n\tif (options.processors) {\n\t\tprocessors.push.apply(processors, options.processors);\n\t}\n\n\tif (options.interactions) {\n\t\tinteractions.push.apply(interactions, options.interactions);\n\t}\n\n\tif (!options.enabled === false) {\n\t\tthis.enabled = false;\n\t}\n}\n\nAction.prototype = Object.create(eev.prototype);\n","import Interaction from './Interaction';\nexport default class PressInteraction extends Interaction {\n\tpressPoint = 0.5;\n\n\tconstructor(pressPoint) {\n\t\tsuper();\n\n\t\tif (pressPoint >= 0) {\n\t\t\tthis.pressPoint = pressPoint;\n\t\t}\n\t}\n\n\tprocess(binding/*, action*/) {\n\t\treturn binding.control.magnitude() > this.pressPoint ?\n\t\t\t'complete' :\n\t\t\t'inactive';\n\t}\n}\n","import Interaction from './Interaction';\nexport default function ReleaseInteraction(pressPoint = 0.5) {\n\tInteraction.call(this);\n\tthis.pressPoint = pressPoint;\n\n\tlet pressed = false;\n\n\tthis.update = binding => {\n\t\tconst wasPressed = pressed;\n\t\tpressed = binding.control.magnitude() > this.pressPoint;\n\n\t\tif (pressed) {\n\t\t\treturn 'active';\n\t\t}\n\n\t\tif (wasPressed) {\n\t\t\treturn 'complete';\n\t\t}\n\n\t\treturn '';\n\t};\n\n\tthis.reset = () => {\n\t\tpressed = false;\n\t};\n}\n\nReleaseInteraction.prototype = Object.create(Interaction.prototype);\n","import StickInputControl from '../../controls/StickInputControl';\n\nexport default function VirtualJoystick({\n\telement = document.body,\n\tradius = 60,\n\tx = 0,\n\ty = 0,\n\tmode = 'dynamic',\n\tlockX = false,\n\tlockY = false,\n\ttouch = true,\n\tpen = true,\n\tmouse = false,\n\tfilter = null,\n\ttouchActionStyle = true\n} = {}) {\n\n\tlet startEvent = null;\n\tlet lastEvent = null;\n\tlet startX = 0;\n\tlet startY = 0;\n\tlet deltaX = 0;\n\tlet deltaY = 0;\n\n\tconst isStatic = mode === 'static';\n\tconst supported = mouse || pen || touch && navigator.maxTouchPoints > 0;\n\n\tconst allowedPointerTypes = {\n\t\tpen,\n\t\tmouse,\n\t\ttouch\n\t};\n\n\t/*\n\tFor now, each device only handles one pointer at a time\n\t*/\n\tfunction pointerDown(evt) {\n\t\tif (!startEvent &&\n\t\t\tallowedPointerTypes[evt.pointerType] && (!filter || filter(evt))) {\n\n\t\t\tif (isStatic) {\n\t\t\t\tconst dx = evt.offsetX - x;\n\t\t\t\tconst dy = evt.offsetY - y;\n\t\t\t\tif (Math.hypot(dx, dy) > radius) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartX = x;\n\t\t\t\tstartY = y;\n\t\t\t} else {\n\t\t\t\tstartX = evt.offsetX;\n\t\t\t\tstartY = evt.offsetY;\n\t\t\t}\n\n\t\t\tstartEvent = evt;\n\t\t\tlastEvent = evt;\n\t\t}\n\t}\n\n\tfunction pointerMove(evt) {\n\t\tif (startEvent && startEvent.pointerId === evt.pointerId) {\n\t\t\tlastEvent = evt;\n\n\t\t\t// calculate and set x/y\n\t\t\tconst dx = lockX ? 0 : evt.offsetX - startX;\n\t\t\tconst dy = lockY ? 0 : evt.offsetY - startY;\n\t\t\tconst length = Math.hypot(dx, dy);\n\n\t\t\tconst divisor = Math.max(length, radius);\n\t\t\tdeltaX = dx / divisor;\n\t\t\tdeltaY = -dy / divisor;\n\t\t}\n\t}\n\n\tfunction pointerUp(evt) {\n\t\tif (startEvent && startEvent.pointerId === evt.pointerId) {\n\t\t\tlastEvent = evt;\n\t\t\tstartEvent = null;\n\t\t}\n\t}\n\n\tconst styleElement = touchActionStyle && element.style ? element : document.body;\n\tif (touchActionStyle) {\n\t\tstyleElement.style.touchAction = 'none';\n\t}\n\n\tthis.getControl = (/*name,*/ options = {}) => {\n\t\t// if (typeof options === 'string') {\n\t\t// \tthrow new Error('VirtualJoystick accepts options object');\n\t\t// }\n\t\tconst read = () => {\n\t\t\treturn startEvent ?\n\t\t\t\t[deltaX, deltaY] :\n\t\t\t\tStickInputControl.defaultValue;\n\t\t};\n\n\t\treturn new StickInputControl(read, Object.assign(\n\t\t\t{},\n\t\t\toptions,\n\t\t\t{ device: this }\n\t\t));\n\t};\n\n\tthis.destroy = () => {\n\t\tif (touchActionStyle) {\n\t\t\tstyleElement.style.touchAction = '';\n\t\t}\n\n\t\telement.removeEventListener('pointerdown', pointerDown);\n\t\telement.removeEventListener('pointermove', pointerMove);\n\t\telement.removeEventListener('pointerup', pointerUp);\n\t\telement.removeEventListener('pointercancel', pointerUp);\n\t};\n\n\tObject.defineProperties(this, {\n\t\tpointerType: {\n\t\t\tget: () => lastEvent && lastEvent.pointerType || ''\n\t\t},\n\n\t\tconnected: {\n\t\t\tenumerable: false,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tvalue: supported\n\t\t},\n\n\t\ttimestamp: {\n\t\t\tget: () => lastEvent && lastEvent.timeStamp || 0\n\t\t},\n\n\t\telement: {\n\t\t\tenumerable: false,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tvalue: element\n\t\t},\n\n\t\tx: {\n\t\t\tget: () => isStatic ? x : startX,\n\t\t\tset: val => {\n\t\t\t\tx = val;\n\t\t\t}\n\t\t},\n\n\t\ty: {\n\t\t\tget: () => isStatic ? y : startY,\n\t\t\tset: val => {\n\t\t\t\ty = val;\n\t\t\t}\n\t\t},\n\n\t\tradius: {\n\t\t\tget: () => radius,\n\t\t\tset: val => {\n\t\t\t\tradius = val;\n\t\t\t}\n\t\t}\n\t});\n\n\tif (supported) {\n\t\telement.addEventListener('pointerdown', pointerDown);\n\t\telement.addEventListener('pointermove', pointerMove);\n\t\telement.addEventListener('pointerup', pointerUp);\n\t\telement.addEventListener('pointercancel', pointerUp);\n\t}\n}\n","export default function DOMRenderer(control, options = {}) {\n\tconst { device } = control;\n\tconst {\n\t\tinnerRadius = Math.max(24, device.radius / 4),\n\t\tparentElement = document.body\n\t} = options;\n\n\tconst outer = document.createElement('div');\n\tObject.assign(outer.style, {\n\t\tposition: 'fixed',\n\t\tpointerEvents: 'none',\n\t\tborderRadius: 999e20 + 'px',\n\n\t\ttransition: 'opacity 0.1s',\n\n\t\t//temp\n\t\tbackgroundColor: 'rgba(128, 128, 128, 0.5)'\n\t});\n\n\tconst inner = document.createElement('div');\n\tObject.assign(inner.style, {\n\t\tposition: 'fixed',\n\t\tpointerEvents: 'none',\n\t\tborderRadius: 999e20 + 'px',\n\n\t\ttransition: 'opacity 0.1s',\n\n\t\t//temp\n\t\tbackgroundColor: 'rgba(128, 128, 128, 0.5)'\n\t});\n\touter.appendChild(inner);\n\n\tlet rafId = 0;\n\n\tfunction render() {\n\t\tconst [x, y] = control.read();\n\n\t\tif (control.mode === 'static' || x || y) {\n\t\t\tconst outerSize = device.radius * 2;\n\t\t\tconst ox = device.x - device.radius;\n\t\t\tconst oy = device.y - device.radius;\n\n\t\t\touter.style.left = ox + 'px';\n\t\t\touter.style.top = oy + 'px';\n\t\t\touter.style.width = outer.style.height = outerSize + 'px';\n\t\t\touter.style.opacity = 1;\n\n\t\t\tconst innerSize = innerRadius * 2;\n\n\t\t\tinner.style.left = device.x + x * device.radius - innerRadius + 'px';\n\t\t\tinner.style.top = device.y - y * device.radius - innerRadius + 'px';\n\t\t\tinner.style.width = inner.style.height = innerSize + 'px';\n\t\t\tinner.style.opacity = 1;\n\t\t} else {\n\t\t\touter.style.opacity = 0;\n\t\t\tinner.style.opacity = 0;\n\t\t}\n\n\t\trafId = requestAnimationFrame(render);\n\t}\n\n\trafId = requestAnimationFrame(render);\n\n\tthis.destroy = () => {\n\t\tcancelAnimationFrame(rafId);\n\n\t\tif (outer.parentNode) {\n\t\t\touter.parentNode.removeChild(outer);\n\t\t}\n\t};\n\n\tparentElement.appendChild(outer);\n}\n","import Gamepad from '../src/devices/gamepad';\nimport Keyboard from '../src/devices/keyboard';\nimport Pointer from '../src/devices/pointer';\nimport DPadComposite from '../src/controls/DPadComposite';\nimport AxisComposite from '../src/controls/AxisComposite';\nimport Action from '../src/Action';\nimport PressInteraction from '../src/interactions/PressInteraction';\nimport ReleaseInteraction from '../src/interactions/ReleaseInteraction';\nimport VirtualJoystick from '../src/devices/virtualjoystick';\nimport DOMRenderer from '../src/devices/virtualjoystick/DOMRenderer';\n\nconst gamepad = new Gamepad();\nconst leftStick = gamepad.getControl('leftStick');\n// const downButton = leftStick.find('down');\nconst rightStickHoriz = gamepad.getControl('rightStick').find('x');\n\nconst kbd = new Keyboard();\nconst kbdWASD = new DPadComposite({\n\tup: kbd.getControl('W'),\n\tleft: kbd.getControl('A'),\n\tdown: kbd.getControl('S'),\n\tright: kbd.getControl('D')\n});\n\nconst pointer = new Pointer();\n\nconst rotateArrowKeys = new AxisComposite({\n\tnegative: kbd.getControl('arrowleft'),\n\tpositive: kbd.getControl('arrowright')\n});\n\nconst leftTouchJoystick = new VirtualJoystick({\n\t// element: window,\n\t// mouse: true,\n\tfilter: evt => evt.pageX < Math.max(200, window.innerWidth * 0.4)\n}).getControl();\nconst leftTouchJoystickRenderer = new DOMRenderer(leftTouchJoystick);\n\nconst rightTouchJoystick = new VirtualJoystick({\n\tfilter: evt => evt.pageX > window.innerWidth - Math.max(200, window.innerWidth * 0.4)\n}).getControl();\nconst rightTouchJoystickRenderer = new DOMRenderer(rightTouchJoystick);\n\nconst moveAction = new Action({\n\tbindings: [\n\t\tleftStick,\n\t\tkbdWASD,\n\t\tleftTouchJoystick,\n\t\t{\n\t\t\tcontrol: pointer.getControl('delta'),\n\t\t\tprocessors: [\n\t\t\t\tvec => [\n\t\t\t\t\tvec[0] / 8,\n\t\t\t\t\t-vec[1] / 8\n\t\t\t\t]\n\t\t\t]\n\t\t}\n\t]\n});\nconst rotateAction = new Action({\n\tbindings: [\n\t\trightStickHoriz,\n\t\trotateArrowKeys,\n\t\trightTouchJoystick,\n\t\tpointer.getControl('wheel')\n\t]\n});\n\nconst buttonAction = new Action({\n\tbindings: [kbd.getControl(' ')],\n\tinteractions: [\n\t\tnew PressInteraction(),\n\t\tnew ReleaseInteraction()\n\t]\n});\n// buttonAction.on('press', () => console.log('spacebar down'));\n// buttonAction.on('release', () => console.log('spacebar up'));\nbuttonAction.on('completed', binding => console.log('interaction', binding));\n\nconst thing = document.createElement('div');\nObject.assign(thing.style, {\n\tposition: 'absolute',\n\twidth: '30px',\n\theight: '60px',\n\tbackgroundColor: 'rebeccapurple',\n\tmargin: '-15px 30px'\n});\ndocument.body.appendChild(thing);\n\nconst speed = 300 / 1000; // pixels per 1000ms\nconst rotSpeed = 360 / 1000; // degrees per 1000ms\nlet x = 100;\nlet y = 100;\nlet r = 30;\n\nlet last = performance.now();\nfunction update(t = performance.now()) {\n\tconst delta = t - last;\n\tlast = t;\n\n\tmoveAction.update();\n\trotateAction.update();\n\tbuttonAction.update();\n\n\tconst [dx, dy] = moveAction.value;\n\tconst dr = rotateAction.value;\n\n\tconst motionScale = speed * delta;\n\tx += dx * motionScale;\n\ty -= dy * motionScale;\n\n\tr += dr * rotSpeed * delta;\n\n\t// render\n\tthing.style.transform = `translate(${x}px, ${y}px) rotate(${r}deg)`;\n\trequestAnimationFrame(update);\n}\n\nupdate();\n","import ButtonInputControl from '../../controls/ButtonInputControl';\nimport boolAsNum from '../../util/boolAsNum';\n\nexport default function Keyboard() {\n\tconst keysDown = new Set();\n\n\tconst onKeyDown = evt => {\n\t\tkeysDown.add(evt.key.toLowerCase());\n\t};\n\tconst onKeyUp = evt => {\n\t\tkeysDown.delete(evt.key.toLowerCase());\n\t};\n\n\tfunction readAnyKey() {\n\t\treturn keysDown.size > 0;\n\t}\n\n\tfunction readSingleKey(key) {\n\t\treturn keysDown.has(key.toLowerCase());\n\t}\n\n\tfunction readFilterKey(filter) {\n\t\treturn readAnyKey() && filter(new Set(keysDown));\n\t}\n\n\tfunction readArrayKey(keys) {\n\t\treturn keys.some(readSingleKey);\n\t}\n\n\tthis.getControl = (name, options = {}) => {\n\t\tconst {\n\t\t\tfilter = name,\n\t\t\t...opts\n\t\t} = options;\n\n\t\tlet read = readAnyKey;\n\t\tif (filter) {\n\t\t\tif (typeof filter === 'string') {\n\t\t\t\tread = () => readSingleKey(filter);\n\t\t\t} else if (typeof filter === 'function') {\n\t\t\t\tread = () => readFilterKey(filter);\n\t\t\t} else if (Array.isArray(filter)) {\n\t\t\t\tread = () => readArrayKey(filter);\n\t\t\t}\n\t\t}\n\n\t\treturn new ButtonInputControl(boolAsNum(read), Object.assign({\n\t\t\tname: typeof name === 'string' && options.filter ?\n\t\t\t\tname :\n\t\t\t\ttypeof filter === 'string' ?\n\t\t\t\t\t`key:${filter}` :\n\t\t\t\t\tString(name || filter)\n\t\t}, opts));\n\t};\n\n\tthis.destroy = () => {\n\t\tkeysDown.clear();\n\t\twindow.removeEventListener('keydown', onKeyDown);\n\t\twindow.removeEventListener('keyup', onKeyUp);\n\t};\n\n\t// assume keyboard is always connected\n\tObject.defineProperty(this, 'connected', {\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t\twritable: false,\n\t\tvalue: true\n\t});\n\n\twindow.addEventListener('keydown', onKeyDown);\n\twindow.addEventListener('keyup', onKeyUp);\n}\n"],"sourceRoot":""}