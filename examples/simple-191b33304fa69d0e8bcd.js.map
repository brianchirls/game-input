{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/devices/gamepad/controlMap.js","webpack:///./src/util/runProcessors.js","webpack:///./src/util/copyOptions.js","webpack:///./src/controls/InputControl.js","webpack:///./src/controls/AxisInputControl.js","webpack:///./src/controls/ButtonInputControl.js","webpack:///./src/controls/Vector2InputControl.js","webpack:///./src/processors/stickDeadZone.js","webpack:///./src/processors/axisDeadZone.js","webpack:///./src/controls/StickInputControl.js","webpack:///./src/util/eventEmitter.js","webpack:///./node_modules/mitt/dist/mitt.es.js","webpack:///./src/devices/gamepad/index.js","webpack:///./src/util/boolAsNum.js","webpack:///./src/devices/pointer/index.js","webpack:///./src/controls/DPadComposite.js","webpack:///./src/controls/AxisComposite.js","webpack:///./src/interactions/Interaction.js","webpack:///./src/Action.js","webpack:///./src/interactions/PressInteraction.js","webpack:///./src/interactions/ReleaseInteraction.js","webpack:///./src/devices/virtualjoystick/index.js","webpack:///./src/devices/virtualjoystick/domView.js","webpack:///./examples/simple.js","webpack:///./src/devices/keyboard/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","buttonIndexes","dpadUp","dpadDown","dpadLeft","dpadRight","L1","L2","L3","R1","R2","R3","A","B","X","Y","start","select","home","buttons","keys","forEach","sticks","reduce","prev","fn","runProcessors","processors","initialValue","copyOptions","dest","src","InputControl","read","options","Map","this","length","path","indexOf","k","substring","child","children","find","defaultValue","val","Math","abs","AxisInputControl","axis","ButtonInputControl","opts","magnitude","pressPoint","Vector2InputControl","vector2","x","parent","y","set","vec","hypot","stickDeadZone","min","max","newMagnitude","absValue","sign","axisDeadZone","scale","makeChild","negative","neg","rawAxisValue","mag","getChildValue","childbuttons","StickInputControl","eventEmitter","obj","all","on","e","push","off","splice","emit","slice","map","clear","standardControlNames","Set","add","readers","device","buttonIndex","leftAxisIndex","axes","axisIndex","boolAsNum","buttonDefs","mouse","touch","pen","buttonNames","getButtonName","evt","button","isPrimary","def","pointerType","values","buttonName","controlDefs","position","constructor","reader","pagePosition","pageX","pageY","screenPosition","screenX","screenY","tilt","contact","width","height","delta","previousEvent","pageDelta","screenDelta","pressure","DPadInputControl","left","right","up","down","AxisComposite","positive","Interaction","binding","control","now","undefined","performance","Date","defaultInteraction","Action","me","clearEvents","bindings","interactions","interactionStack","destroyed","enabled","activeBinding","activeTime","state","transitionState","nextState","events","Error","event","clearInteractions","interaction","reset","processInteraction","stackIndex","findIndex","iState","newState","process","unbind","index","update","previousBinding","best","Infinity","controlValue","interactionBinding","interacted","shift","destroy","defineProperties","activeControl","apply","PressInteraction","ReleaseInteraction","pressed","wasPressed","VirtualJoystick","element","document","body","radius","lockX","lockY","filter","touchActionStyle","startEvent","lastEvent","startX","startY","deltaX","deltaY","isStatic","supported","navigator","maxTouchPoints","allowedPointerTypes","pointerDown","dx","offsetX","dy","offsetY","pointerMove","pointerId","divisor","pointerUp","styleElement","style","touchAction","getControl","removeEventListener","connected","configurable","writable","timestamp","timeStamp","addEventListener","domView","innerRadius","parentElement","outer","createElement","pointerEvents","borderRadius","transition","backgroundColor","inner","appendChild","rafId","render","outerSize","ox","oy","top","opacity","innerSize","requestAnimationFrame","cancelAnimationFrame","parentNode","removeChild","gamepad","updatePeriod","controlIndices","lastDevice","lastDeviceUpdate","getGamepads","stickName","onConnected","gp","onDisconnected","has","delete","ControlConstructor","controls","window","id","leftStick","rightStickHoriz","kbd","keysDown","onKeyDown","toLowerCase","onKeyUp","readAnyKey","size","readSingleKey","readFilterKey","readArrayKey","some","Array","isArray","String","kbdWASD","DPadComposite","pointer","lastWheelEvent","buttonsDown","saveEvent","mask","buttonDown","onWheel","readButton","controlSpec","rotateArrowKeys","leftTouchJoystick","innerWidth","rightTouchJoystick","moveAction","rotateAction","buttonAction","console","log","thing","margin","last","dr","motionScale","transform"],"mappings":"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","file":"examples/simple-191b33304fa69d0e8bcd.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/game-input/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","const buttonIndexes = {\n\tdpadUp: 12,\n\tdpadDown: 13,\n\tdpadLeft: 14,\n\tdpadRight: 15,\n\tL1: 4,\n\tL2: 6,\n\tL3: 10,\n\tR1: 5,\n\tR2: 7,\n\tR3: 11,\n\tA: 0,\n\tB: 1,\n\tX: 2,\n\tY: 3,\n\tstart: 9,\n\tselect: 8,\n\thome: 16\n};\nconst buttons = [];\nObject.keys(buttonIndexes).forEach(key => {\n\tbuttons[buttonIndexes[key]] = key;\n});\n\nconst axes = [\n\t'leftStickX',\n\t'leftStickY',\n\t'rightStickX',\n\t'rightStickY'\n];\n\nconst sticks = [\n\t'leftStick',\n\t'rightStick'\n];\n\nexport {\n\tbuttons,\n\tbuttonIndexes,\n\taxes,\n\tsticks\n};\n","const reduce = (prev, fn) => fn(prev);\n\nexport default function runProcessors(processors, initialValue) {\n\treturn processors.reduce(reduce, initialValue);\n}\n","export default function copyOptions(dest, src) {\n\tif (!src) {\n\t\treturn;\n\t}\n\tObject.keys(dest).forEach(key => {\n\t\tif (key in src && typeof dest[key] !== 'function') {\n\t\t\tdest[key] = src[key];\n\t\t}\n\t});\n}\n\n","import runProcessors from '../util/runProcessors';\nimport copyOptions from '../util/copyOptions';\n\nexport default class InputControl {\n\tstatic defaultValue = 0;\n\n\tname = '';\n\tparent = null;\n\tchildren = new Map();\n\tdevice = null;\n\tprocessors = [];\n\n\tconstructor(read, options) {\n\t\tcopyOptions(this, options);\n\t\tthis.read = this.processors.length ?\n\t\t\t() => runProcessors(this.processors, read()) :\n\t\t\tread || this.read;\n\t}\n\n\tfind(path) {\n\t\tif (!path) {\n\t\t\treturn this;\n\t\t}\n\n\t\tconst i = path.indexOf('/');\n\t\tif (i > 0) {\n\t\t\tconst k = path.substring(0, i);\n\t\t\tconst child = this.children.get(k);\n\t\t\tif (child) {\n\t\t\t\treturn child.find(path.substring(k + 1));\n\t\t\t}\n\t\t}\n\n\t\treturn this.children.get(path) || null;\n\t}\n\n\tread() {\n\t\treturn this.prototype.defaultValue;\n\t}\n\n\tmagnitude(val = this.read()) {\n\t\treturn Math.abs(val);\n\t}\n}\n","import InputControl from './InputControl';\n\nexport default class AxisInputControl extends InputControl {\n\tconstructor(read = () => 0, options) {\n\t\tsuper(read, options);\n\t\tthis.axis = this.read;\n\t}\n}\n","import AxisInputControl from './AxisInputControl';\nimport copyOptions from '../util/copyOptions';\n\nexport default class ButtonInputControl extends AxisInputControl {\n\tpressPoint = 0.5;\n\tconstructor(read, opts) {\n\t\tsuper(read, opts);\n\t\tcopyOptions(this, opts);\n\t}\n\n\tpressed(value = this.magnitude()) {\n\t\treturn value >= this.pressPoint;\n\t}\n}\n","import InputControl from './InputControl';\nimport AxisInputControl from './AxisInputControl';\n\nexport default class Vector2InputControl extends InputControl {\n\tstatic defaultValue = [0, 0];\n\n\tconstructor(read, options) {\n\t\tsuper(read, options);\n\n\t\tthis.vector2 = this.read;\n\t\tthis.x = new AxisInputControl(() => this.read()[0], Object.assign({}, options && options.x, {\n\t\t\tparent: this\n\t\t}));\n\n\t\t// i don't know why this is negative, but it is\n\t\tthis.y = new AxisInputControl(() => this.read()[1], Object.assign({}, options && options.y, {\n\t\t\tparent: this\n\t\t}));\n\t\tthis.children.set('x', this.x);\n\t\tthis.children.set('y', this.x);\n\t}\n\n\tmagnitude(vec = this.read()) {\n\t\treturn Math.hypot(vec[0], vec[1]);\n\t}\n}\n","import axisDeadZone from './axisDeadZone';\n\nexport default function stickDeadZone(value, min, max) {\n\tconst [x, y] = value;\n\tconst magnitude = Math.hypot(x, y);\n\tconst newMagnitude = axisDeadZone(magnitude, min, max);\n\n\tif (newMagnitude === 0) {\n\t\treturn [0, 0];\n\t}\n\n\tconst scale = newMagnitude / magnitude;\n\treturn [x * scale, y * scale];\n}\n","export default function axisDeadZone(value, min = 0.125, max = 0.925) {\n\tconst absValue = Math.abs(value);\n\tif (absValue < min) {\n\t\treturn 0;\n\t}\n\tif (absValue > max) {\n\t\treturn Math.sign(value);\n\t}\n\n\treturn Math.sign(value) * (absValue - min) / (max - min);\n}\n","import Vector2InputControl from './Vector2InputControl';\nimport ButtonInputControl from './ButtonInputControl';\nimport stickDeadZone from '../processors/stickDeadZone';\n\nfunction getChildValue(read, axis, neg) {\n\tconst vec = read();\n\tconst rawAxisValue = vec[axis];\n\tconst mag = Math.abs(neg ? -rawAxisValue : rawAxisValue);\n\treturn Math.max(0, mag);\n}\n\nfunction makeChild(parent, name, axis, negative, options) {\n\tconst opts = Object.assign({}, options && options[name], {\n\t\tparent\n\t});\n\tparent[name] = new ButtonInputControl(() => getChildValue(axis, negative), opts);\n\n\tparent.children.set(name, parent[name]);\n}\n\nconst childbuttons = [\n\t['left', 0, true],\n\t['right', 0, false],\n\t['down', 1, true],\n\t['up', 1, false]\n];\n\nexport default class StickInputControl extends Vector2InputControl {\n\tconstructor(read, options) {\n\t\tsuper(read, Object.assign(\n\t\t\t{\n\t\t\t\tprocessors: [stickDeadZone]\n\t\t\t},\n\t\t\toptions\n\t\t));\n\n\t\tchildbuttons.forEach(([name, axis, negative]) => {\n\t\t\tmakeChild(this, name, axis, negative, options);\n\t\t});\n\t}\n}\n","import mitt from 'mitt';\n\nexport default function eventEmitter(obj) {\n\tconst {\n\t\tall,\n\t\ton,\n\t\toff,\n\t\temit\n\t} = mitt();\n\n\tObject.assign(obj, {\n\t\ton,\n\t\toff,\n\t\temit\n\t});\n\n\treturn () => all.clear();\n}\n","export default function(n){return{all:n=n||new Map,on:function(t,e){var i=n.get(t);i&&i.push(e)||n.set(t,[e])},off:function(t,e){var i=n.get(t);i&&i.splice(i.indexOf(e)>>>0,1)},emit:function(t,e){(n.get(t)||[]).slice().map(function(n){n(e)}),(n.get(\"*\")||[]).slice().map(function(n){n(t,e)})}}}\n//# sourceMappingURL=mitt.es.js.map\n","import {\n\tbuttons,\n\tsticks\n} from './controlMap';\nimport ButtonInputControl from '../../controls/ButtonInputControl';\nimport StickInputControl from '../../controls/StickInputControl';\nimport AxisInputControl from '../../controls/AxisInputControl';\nimport eventEmitter from '../../util/eventEmitter';\n\nconst standardControlNames = new Set(buttons);\nsticks.forEach(n => standardControlNames.add(n));\n\nconst readers = new Map([\n\t[ButtonInputControl, (device, buttonIndex) => device.buttons[buttonIndex].value],\n\t[StickInputControl, (device, leftAxisIndex) => [\n\t\tdevice.axes[leftAxisIndex],\n\t\t-device.axes[leftAxisIndex + 1]\n\t]],\n\t[AxisInputControl, (device, axisIndex) => device.axes[axisIndex]]\n]);\n\nexport default function Gamepad(index = 0, {\n\tupdatePeriod = 1000 / 120\n} = {}) {\n\tconst clearEvents = eventEmitter(this);\n\n\tconst controlDefs = new Map();\n\tconst controlIndices = new Map();\n\tlet lastDevice = null;\n\tlet lastDeviceUpdate = 0;\n\n\tbuttons.forEach((buttonName, i) => {\n\t\tcontrolDefs.set(buttonName, ButtonInputControl);\n\t\tcontrolIndices.set(buttonName, i);\n\t});\n\n\tsticks.forEach((stickName, i) => {\n\t\tcontrolDefs.set(stickName, StickInputControl);\n\t\tcontrolIndices.set(stickName, i * 2);\n\t});\n\n\tfunction update() {\n\t\tconst device = navigator.getGamepads()[index];\n\t\tconst timestamp = device && device.timestamp || performance.now();\n\t\tif (device && timestamp - lastDeviceUpdate >= updatePeriod) {\n\t\t\tlastDevice = device;\n\t\t\tlastDeviceUpdate = timestamp;\n\t\t}\n\t}\n\n\tconst onConnected = evt => {\n\t\tconst gp = evt.gamepad;\n\t\tif (gp.index === index) {\n\t\t\tupdate();\n\n\t\t\t// set any additional buttons or axes\n\t\t\tfor (let i = buttons.length; i < gp.buttons.length; i++) {\n\t\t\t\tconst name = 'button' + i;\n\t\t\t\tcontrolDefs.set(name, ButtonInputControl);\n\t\t\t\tcontrolIndices.set(name, i);\n\t\t\t}\n\n\t\t\tfor (let i = 4; i < gp.axes.length; i++) {\n\t\t\t\tconst name = 'axis' + i;\n\t\t\t\tcontrolDefs.set(name, AxisInputControl);\n\t\t\t\tcontrolIndices.set(name, i);\n\t\t\t}\n\n\t\t\tthis.emit('connected');\n\t\t}\n\t};\n\n\tconst onDisconnected = evt => {\n\t\tconst gp = evt.gamepad;\n\t\tif (gp.index === index) {\n\t\t\t// remove any extra controls\n\t\t\tcontrolDefs.forEach((def, key) => {\n\t\t\t\tif (!standardControlNames.has(key)) {\n\t\t\t\t\tcontrolDefs.delete(key);\n\t\t\t\t\tcontrolIndices.delete(key);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.emit('disconnected');\n\t\t}\n\t};\n\n\tthis.getControl = (name, options) => {\n\t\tconst ControlConstructor = controlDefs.get(name);\n\t\tif (!ControlConstructor) {\n\t\t\tthrow new Error('Control not found');\n\t\t}\n\n\t\tconst reader = readers.get(ControlConstructor);\n\t\tconst index = controlIndices.get(name);\n\t\tconst read = () => {\n\t\t\tupdate();\n\t\t\treturn lastDevice ?\n\t\t\t\treader(lastDevice, index) :\n\t\t\t\tControlConstructor.defaultValue;\n\t\t};\n\n\t\treturn new ControlConstructor(read, Object.assign({\n\t\t\tname\n\t\t}, options, {\n\t\t\tdevice: this\n\t\t}));\n\t};\n\n\tthis.controls = () => controlDefs.keys();\n\n\tthis.destroy = () => {\n\t\tclearEvents();\n\t\twindow.removeEventListener('gamepadconnected', onConnected);\n\t\twindow.removeEventListener('gamepaddisconnected', onDisconnected);\n\t};\n\n\tObject.defineProperties(this, {\n\t\tdevice: {\n\t\t\tget: () => lastDevice\n\t\t},\n\t\tid: {\n\t\t\tget: () => lastDevice && lastDevice.id || null\n\t\t},\n\t\tconnected: {\n\t\t\tget: () => !!lastDevice && lastDevice.connected\n\t\t},\n\t\ttimestamp: {\n\t\t\tget: () => lastDeviceUpdate\n\t\t}\n\t});\n\n\tupdate();\n\twindow.addEventListener('gamepadconnected', onConnected);\n\twindow.addEventListener('gamepaddisconnected', onDisconnected);\n}\n","const boolAsNum = fn => () => fn() ? 1 : 0;\nexport default boolAsNum;\n","import ButtonInputControl from '../../controls/ButtonInputControl';\nimport AxisInputControl from '../../controls/AxisInputControl';\nimport Vector2InputControl from '../../controls/Vector2InputControl';\nimport boolAsNum from '../../util/boolAsNum';\n\nconst buttonDefs = [\n\t{\n\t\tmouse: 'leftMouseButton',\n\t\ttouch: 'touch',\n\t\tpen: 'penTip'\n\t},\n\t{\n\t\tmouse: 'middleMouseButton'\n\t},\n\t{\n\t\tmouse: 'rightMouseButton',\n\t\tpen: 'penBarrelButton'\n\t},\n\t{\n\t\tmouse: 'mouseBackButton'\n\t},\n\t{\n\t\tmouse: 'mouseForwardButton'\n\t},\n\t{\n\t\tpen: 'penEraser'\n\t}\n];\n\nconst buttonNames = new Set();\nbuttonDefs.forEach(def => {\n\tfor (const buttonName of Object.values(def)) {\n\t\tbuttonNames.add(buttonName);\n\t}\n});\n\nfunction getButtonName(evt, buttonIndex = evt.button) {\n\tif (buttonIndex >= 0 && buttonIndex < buttonDefs.length && evt.isPrimary) {\n\t\tconst def = buttonDefs[buttonIndex];\n\t\treturn def[evt.pointerType] || '';\n\t}\n\n\treturn '';\n}\n\nconst controlDefs = {\n\tposition: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.x, evt.y]\n\t},\n\tpagePosition: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.pageX, evt.pageY]\n\t},\n\tscreenPosition: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.screenX, evt.screenY]\n\t},\n\ttilt: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.screenX / 90, evt.screenY / 90]\n\t},\n\tcontact: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: evt => [evt.width, evt.height]\n\t},\n\tdelta: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: (evt, previousEvent, defaultValue) => previousEvent ?\n\t\t\t[evt.x - previousEvent.x, evt.y - previousEvent.y] :\n\t\t\tdefaultValue\n\t},\n\tpageDelta: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: (evt, previousEvent, defaultValue) => previousEvent ?\n\t\t\t[evt.pageX - previousEvent.pageX, evt.pageY - previousEvent.pageY] :\n\t\t\tdefaultValue\n\t},\n\tscreenDelta: {\n\t\tconstructor: Vector2InputControl,\n\t\treader: (evt, previousEvent, defaultValue) => previousEvent ?\n\t\t\t[evt.screenX - previousEvent.screenX, evt.screenY - previousEvent.screenY] :\n\t\t\tdefaultValue\n\t},\n\tpressure: {\n\t\tconstructor: AxisInputControl,\n\t\treader: evt => evt.pressure || 0\n\t}\n};\n\n/*\nFor now, this only allows for a single, primary device\n\ntodo:\n- option to specify device by index/pointerId\n- option to filter by device type\n- how do we handle multiple pointers at a time, like touch?\n  https://devdocs.io/dom/pointer_events/multi-touch_interaction\n  `navigator.maxTouchPoints`\n- pinch/zoom\n  https://devdocs.io/dom/pointer_events/pinch_zoom_gestures\n- detect available devices (static method?)\n- we could certainly use adjustable sensitivity/scaling values\n  or I guess that could be done by a Processor\n*/\n\nexport default function Pointer({\n\tupdatePeriod = 1000 / 60,\n\telement = document.body,\n\ttouch = true,\n\tpen = true,\n\tmouse = true,\n\ttouchActionStyle = true\n} = {}) {\n\tlet previousEvent = null;\n\tlet lastEvent = null;\n\tlet lastWheelEvent = null;\n\n\tconst allowedPointerTypes = {\n\t\tpen,\n\t\tmouse,\n\t\ttouch\n\t};\n\n\tconst buttonsDown = new Set();\n\n\tconst saveEvent = evt => {\n\t\tif (evt.isPrimary && allowedPointerTypes[evt.pointerType]) {\n\t\t\tpreviousEvent = lastEvent;\n\t\t\tlastEvent = evt;\n\n\t\t\tfor (let i = 0; i < buttonDefs.length; i++) {\n\t\t\t\t/* eslint-disable no-bitwise */\n\t\t\t\tconst mask = 1 << i;\n\t\t\t\tconst buttonDown = evt.buttons & mask;\n\t\t\t\t/* eslint-enable no-bitwise */\n\t\t\t\tconst name = getButtonName(evt, i);\n\t\t\t\tif (buttonDown) {\n\t\t\t\t\tbuttonsDown.add(name);\n\t\t\t\t} else {\n\t\t\t\t\tbuttonsDown.delete(name);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst onWheel = evt => {\n\t\tlastWheelEvent = evt;\n\t};\n\n\tfunction update() {\n\t\tif (lastEvent && performance.now() - lastEvent.timeStamp > updatePeriod) {\n\t\t\tpreviousEvent = lastEvent;\n\t\t}\n\n\t\tif (lastWheelEvent && performance.now() - lastWheelEvent.timeStamp > updatePeriod) {\n\t\t\tlastWheelEvent = null;\n\t\t}\n\t}\n\n\tfunction readButton(name) {\n\t\treturn buttonsDown.has(name.toLowerCase());\n\t}\n\n\tconst styleElement = touchActionStyle && element.style ? element : document.body;\n\tif (touchActionStyle) {\n\t\tstyleElement.style.touchAction = 'none';\n\t}\n\n\tthis.getControl = (name, options = {}) => {\n\t\tconst controlSpec = controlDefs[name];\n\t\tif (controlSpec) {\n\t\t\tconst {\n\t\t\t\tconstructor: ControlConstructor,\n\t\t\t\treader\n\t\t\t} = controlSpec;\n\n\t\t\tconst read = () => {\n\t\t\t\tupdate();\n\t\t\t\treturn lastEvent ?\n\t\t\t\t\treader(lastEvent, previousEvent, ControlConstructor.defaultValue) :\n\t\t\t\t\tControlConstructor.defaultValue;\n\t\t\t};\n\n\t\t\treturn new ControlConstructor(read, Object.assign({\n\t\t\t\tname\n\t\t\t}, options, {\n\t\t\t\tdevice: this\n\t\t\t}));\n\t\t}\n\n\t\tif (buttonNames.has(name)) {\n\t\t\treturn new ButtonInputControl(boolAsNum(() => readButton(name)), Object.assign({\n\t\t\t\tname\n\t\t\t}, options));\n\t\t}\n\n\t\t/*\n\t\tAccording to the spec, delta values can vary by deltaMode, but\n\t\tit seems that all browsers currently report values in pixels\n\t\t*/\n\t\tif (name === 'wheel') {\n\t\t\treturn new Vector2InputControl(\n\t\t\t\t() => {\n\t\t\t\t\tupdate();\n\t\t\t\t\treturn lastWheelEvent ?\n\t\t\t\t\t\t[lastWheelEvent.deltaX, lastWheelEvent.deltaY] :\n\t\t\t\t\t\tVector2InputControl.defaultValue;\n\t\t\t\t},\n\t\t\t\tObject.assign({\n\t\t\t\t\tname\n\t\t\t\t}, options, {\n\t\t\t\t\tdevice: this\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tthrow new Error('Control not found');\n\t};\n\n\tthis.destroy = () => {\n\t\tif (touchActionStyle) {\n\t\t\t// todo: only if it wasn't set before\n\t\t\tstyleElement.style.touchAction = '';\n\t\t}\n\n\t\tbuttonsDown.clear();\n\t\twindow.removeEventListener('pointerdown', saveEvent);\n\t\twindow.removeEventListener('pointerup', saveEvent);\n\t\twindow.removeEventListener('pointermove', saveEvent);\n\t\twindow.removeEventListener('wheel', onWheel);\n\t};\n\n\tObject.defineProperties(this, {\n\t\tpointerType: {\n\t\t\tget: () => lastEvent && lastEvent.pointerType || ''\n\t\t},\n\n\t\t// assume pointer is always connected?\n\t\t// ...not necessarily\n\t\tconnected: {\n\t\t\tenumerable: false,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tvalue: true\n\t\t},\n\t\ttimestamp: {\n\t\t\tget: () => lastEvent && lastEvent.timeStamp || 0\n\t\t}\n\t});\n\n\twindow.addEventListener('pointerdown', saveEvent);\n\twindow.addEventListener('pointerup', saveEvent);\n\twindow.addEventListener('pointermove', saveEvent);\n\twindow.addEventListener('wheel', onWheel);\n}\n","import Vector2InputControl from './Vector2InputControl';\n\nexport default class DPadInputControl extends Vector2InputControl {\n\tconstructor({\n\t\tleft,\n\t\tright,\n\t\tup,\n\t\tdown,\n\t\t...opts\n\t}) {\n\t\tconst read = () => {\n\t\t\tconst x = right.read() - left.read();\n\t\t\tconst y = up.read() - down.read();\n\t\t\treturn [x, y];\n\t\t};\n\t\tsuper(read, opts);\n\n\t\tthis.children.set('left', left);\n\t\tthis.children.set('right', right);\n\t\tthis.children.set('up', up);\n\t\tthis.children.set('down', down);\n\t}\n}\n","import AxisInputControl from './AxisInputControl';\n\nexport default class AxisComposite extends AxisInputControl {\n\tconstructor({\n\t\tnegative,\n\t\tpositive,\n\t\t...opts\n\t}) {\n\t\tconst read = () => {\n\t\t\tconst neg = negative.read();\n\t\t\tconst pos = positive.read();\n\t\t\treturn pos - neg;\n\t\t};\n\t\tsuper(read, opts);\n\n\t\tthis.children.set('negative', negative);\n\t\tthis.children.set('positive', positive);\n\t}\n}\n","export default class Interaction {\n\tprocess(binding/*, action*/) {\n\t\treturn binding.control.magnitude() > 0 ? 'complete' : 'inactive';\n\t}\n\n\treset() {}\n}\n","import runProcessors from './util/runProcessors';\nimport InputControl from './controls/InputControl';\nimport Interaction from './interactions/Interaction';\nimport eventEmitter from './util/eventEmitter';\n\n/*\ntodo: use something like hrtime or performance.now in node.js\n*/\nconst now = typeof performance === undefined ?\n\t() => performance.now() : // eslint-disable-line no-undef\n\t() => Date.now();\n\n/*\ntodo: give everything ids so we can reference them later.\nprobably.\n*/\nconst defaultInteraction = new Interaction();\n\nexport default function Action(options = {}) {\n\tconst me = this;\n\tconst clearEvents = eventEmitter(this);\n\n\tthis.name = options.name || '';\n\n\tconst bindings = [];\n\tconst processors = [];\n\tconst interactions = [];\n\tconst interactionStack = [];\n\n\tlet destroyed = false;\n\tlet enabled = true;\n\tlet activeBinding = null;\n\tlet activeTime = 0;\n\tlet state = 'inactive';\n\tlet value;\n\n\tthis.bindings = bindings;\n\tthis.processors = processors;\n\tthis.interactions = interactions;\n\n\t/*\n\tstates\n\t- inactive\n\t  - => active: started\n\t  - => complete: started, completed\n\t- active\n\t  - => complete: completed\n\t  - => inactive: canceled, ended\n\t- complete\n\t  - => inactive: ended\n\t*/\n\tconst transitionState = (nextState, binding) => {\n\t\tif (nextState === state || !enabled) { // todo: and binding hasn't changed\n\t\t\treturn;\n\t\t}\n\n\t\tif (nextState === 'active' && state === 'complete') {\n\t\t\t// stay right where we are\n\t\t\treturn;\n\t\t}\n\n\t\tconst events = [];\n\n\t\tif (nextState === 'complete') {\n\t\t\ttransitionState('active', binding);\n\t\t\tevents.push('completed');\n\t\t} else if (nextState === 'inactive') {\n\t\t\tif (state !== 'complete') {\n\t\t\t\tevents.push('canceled');\n\t\t\t}\n\t\t\tevents.push('ended');\n\t\t} else if (nextState === 'active') {\n\t\t\tevents.push('started');\n\t\t} else {\n\t\t\tthrow new Error('Unsupported state: ' + nextState);\n\t\t}\n\n\t\tstate = nextState;\n\t\tevents.forEach(event => this.emit(event, binding));\n\t};\n\n\tfunction clearInteractions() {\n\t\tinteractionStack.forEach(({ interaction }) => interaction.reset());\n\t\tinteractionStack.length = 0;\n\t}\n\n\tfunction processInteraction(binding, interaction) {\n\t\tlet stackIndex = interactionStack.findIndex(\n\t\t\tiState => iState.binding === binding && iState.interaction === interaction\n\t\t);\n\t\tlet iState = stackIndex >= 0 && interactionStack[stackIndex];\n\n\t\tconst newState = interaction.process(binding, me) ||\n\t\t\tiState && iState.state ||\n\t\t\t'inactive';\n\n\t\tif (stackIndex < 0 && newState !== 'inactive') {\n\t\t\tstackIndex = interactionStack.length;\n\t\t\tiState = {\n\t\t\t\tbinding,\n\t\t\t\tinteraction,\n\t\t\t\tstate: 'inactive'\n\t\t\t};\n\t\t\tinteractionStack.push(iState);\n\t\t}\n\t\tif (iState) {\n\t\t\tiState.state = newState;\n\t\t}\n\t}\n\n\t/*\n\ttodo: we need better CRUD methods for bindings, processors and interactions\n\t*/\n\tthis.bind = (control, options) => {\n\t\tif (!options && !(control instanceof InputControl)) {\n\t\t\toptions = control;\n\t\t}\n\t\tif (options && options.control) {\n\t\t\tcontrol = options.control;\n\t\t}\n\n\t\tif (!(control instanceof InputControl)) {\n\t\t\t// could we do this by duck-typing?\n\t\t\tthrow new Error('Binding requires an InputControl');\n\t\t}\n\n\t\tconst binding = {\n\t\t\tcontrol,\n\t\t\tprocessors: options && options.processors,\n\t\t\tinteractions: options && options.interactions\n\t\t};\n\t\tbindings.push(binding);\n\t\treturn bindings.length - 1;\n\t};\n\n\tthis.unbind = index => {\n\t\tif (index < bindings.length) {\n\t\t\tconst binding = bindings.splice(index, 1);\n\t\t\tif (binding === activeBinding) {\n\t\t\t\t// todo: reset state\n\t\t\t}\n\n\t\t\t// todo: clear binding from queue\n\t\t}\n\t};\n\n\tthis.update = () => {\n\t\tif (!enabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousBinding = activeBinding;\n\t\tactiveBinding = null;\n\n\t\tlet best = -Infinity;\n\t\tfor (let i = 0; i < bindings.length; i++) {\n\t\t\tconst binding = bindings[i];\n\t\t\tconst { control } = binding;\n\t\t\tconst controlValue = binding.processors ?\n\t\t\t\trunProcessors(binding.processors, control.read()) :\n\t\t\t\tcontrol.read();\n\t\t\tconst magnitude = control.magnitude(controlValue);\n\t\t\tif (magnitude > best) {\n\t\t\t\tvalue = controlValue;\n\t\t\t\tbest = magnitude;\n\t\t\t\tif (magnitude > 0) {\n\t\t\t\t\tactiveBinding = binding;\n\t\t\t\t\tif (!activeTime) {\n\t\t\t\t\t\tactiveTime = now();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!activeBinding) {\n\t\t\tactiveTime = 0;\n\t\t}\n\n\t\t// should processor happen before disambiguation?\n\t\tif (value !== undefined) {\n\t\t\tvalue = runProcessors(processors, value);\n\t\t}\n\n\t\t// interactions, events\n\t\tconst interactionBinding = activeBinding || previousBinding;\n\t\tlet interacted = interactions.length > 0;\n\t\tif (interactionBinding && interactionBinding.interactions) {\n\t\t\tinteracted = interacted || interactionBinding.interactions.length > 0;\n\t\t\tinteractionBinding.interactions.forEach(\n\t\t\t\tinteraction => processInteraction(interactionBinding, interaction)\n\t\t\t);\n\t\t}\n\n\t\t// todo: this will not catch deactivated controls that need to be processed\n\t\t// we need to re-think this whole flow\n\t\tif (interactionBinding) {\n\t\t\tinteractions.forEach(\n\t\t\t\tinteraction => processInteraction(interactionBinding, interaction)\n\t\t\t);\n\t\t}\n\n\t\tif (interactionBinding && !interacted) {\n\t\t\tprocessInteraction(interactionBinding, defaultInteraction);\n\t\t}\n\n\t\twhile (interactionStack.length) {\n\t\t\tconst iState = interactionStack[0];\n\t\t\tif (iState.state === 'inactive') {\n\t\t\t\tinteractionStack.shift();\n\t\t\t\tiState.interaction.reset();\n\t\t\t\ttransitionState(iState.state, iState.binding);\n\t\t\t} else {\n\t\t\t\tif (iState.state === 'complete') {\n\t\t\t\t\tclearInteractions();\n\t\t\t\t\ttransitionState('complete', iState.binding);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!interactionStack.length) {\n\t\t\t// resetInteractions();\n\t\t\ttransitionState('inactive');\n\t\t}\n\t};\n\n\tthis.destroy = () => {\n\t\tdestroyed = true;\n\t\tenabled = false;\n\t\tclearInteractions();\n\t\ttransitionState('inactive');\n\t\tstate = 'destroyed';\n\t\tclearEvents();\n\t};\n\n\tObject.defineProperties(this, {\n\t\tenabled: {\n\t\t\tset(val) {\n\t\t\t\tval = !!val;\n\t\t\t\tif (val !== enabled && !destroyed) {\n\t\t\t\t\tenabled = val;\n\t\t\t\t\ttransitionState('inactive');\n\t\t\t\t\tstate = enabled ? 'inactive' : 'disabled';\n\t\t\t\t\tclearInteractions();\n\t\t\t\t}\n\t\t\t},\n\t\t\tget: () => enabled\n\t\t},\n\t\tactiveControl: {\n\t\t\tget: () => activeBinding && activeBinding.control\n\t\t},\n\t\tstate: {\n\t\t\tget: () => state\n\t\t},\n\t\tvalue: {\n\t\t\tget: () => value\n\t\t}\n\t});\n\n\tif (options.bindings) {\n\t\toptions.bindings.forEach(binding => {\n\t\t\tthis.bind(binding);\n\t\t});\n\t}\n\n\tif (options.processors) {\n\t\tprocessors.push.apply(processors, options.processors);\n\t}\n\n\tif (options.interactions) {\n\t\tinteractions.push.apply(interactions, options.interactions);\n\t}\n\n\tif (!options.enabled === false) {\n\t\tthis.enabled = false;\n\t}\n}\n","import Interaction from './Interaction';\nexport default class PressInteraction extends Interaction {\n\tpressPoint = 0.5;\n\n\tconstructor(pressPoint) {\n\t\tsuper();\n\n\t\tif (pressPoint >= 0) {\n\t\t\tthis.pressPoint = pressPoint;\n\t\t}\n\t}\n\n\tprocess(binding/*, action*/) {\n\t\treturn binding.control.magnitude() > this.pressPoint ?\n\t\t\t'complete' :\n\t\t\t'inactive';\n\t}\n}\n","import Interaction from './Interaction';\nexport default function ReleaseInteraction(pressPoint = 0.5) {\n\tInteraction.call(this);\n\tthis.pressPoint = pressPoint;\n\n\tlet pressed = false;\n\n\tthis.update = binding => {\n\t\tconst wasPressed = pressed;\n\t\tpressed = binding.control.magnitude() > this.pressPoint;\n\n\t\tif (pressed) {\n\t\t\treturn 'active';\n\t\t}\n\n\t\tif (wasPressed) {\n\t\t\treturn 'complete';\n\t\t}\n\n\t\treturn '';\n\t};\n\n\tthis.reset = () => {\n\t\tpressed = false;\n\t};\n}\n\nReleaseInteraction.prototype = Object.create(Interaction.prototype);\n","import StickInputControl from '../../controls/StickInputControl';\n\nexport default function VirtualJoystick({\n\telement = document.body,\n\tradius = 60,\n\tx = 0,\n\ty = 0,\n\tmode = 'dynamic',\n\tlockX = false,\n\tlockY = false,\n\ttouch = true,\n\tpen = true,\n\tmouse = false,\n\tfilter = null,\n\ttouchActionStyle = true\n} = {}) {\n\n\tlet startEvent = null;\n\tlet lastEvent = null;\n\tlet startX = 0;\n\tlet startY = 0;\n\tlet deltaX = 0;\n\tlet deltaY = 0;\n\n\tconst isStatic = mode === 'static';\n\tconst supported = mouse || pen || touch && navigator.maxTouchPoints > 0;\n\n\tconst allowedPointerTypes = {\n\t\tpen,\n\t\tmouse,\n\t\ttouch\n\t};\n\n\t/*\n\tFor now, each device only handles one pointer at a time\n\t*/\n\tfunction pointerDown(evt) {\n\t\tif (!startEvent &&\n\t\t\tallowedPointerTypes[evt.pointerType] && (!filter || filter(evt))) {\n\n\t\t\tif (isStatic) {\n\t\t\t\tconst dx = evt.offsetX - x;\n\t\t\t\tconst dy = evt.offsetY - y;\n\t\t\t\tif (Math.hypot(dx, dy) > radius) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstartX = x;\n\t\t\t\tstartY = y;\n\t\t\t} else {\n\t\t\t\tstartX = evt.offsetX;\n\t\t\t\tstartY = evt.offsetY;\n\t\t\t}\n\n\t\t\tstartEvent = evt;\n\t\t\tlastEvent = evt;\n\t\t}\n\t}\n\n\tfunction pointerMove(evt) {\n\t\tif (startEvent && startEvent.pointerId === evt.pointerId) {\n\t\t\tlastEvent = evt;\n\n\t\t\t// calculate and set x/y\n\t\t\tconst dx = lockX ? 0 : evt.offsetX - startX;\n\t\t\tconst dy = lockY ? 0 : evt.offsetY - startY;\n\t\t\tconst length = Math.hypot(dx, dy);\n\n\t\t\tconst divisor = Math.max(length, radius);\n\t\t\tdeltaX = dx / divisor;\n\t\t\tdeltaY = -dy / divisor;\n\t\t}\n\t}\n\n\tfunction pointerUp(evt) {\n\t\tif (startEvent && startEvent.pointerId === evt.pointerId) {\n\t\t\tlastEvent = evt;\n\t\t\tstartEvent = null;\n\t\t}\n\t}\n\n\tconst styleElement = touchActionStyle && element.style ? element : document.body;\n\tif (touchActionStyle) {\n\t\tstyleElement.style.touchAction = 'none';\n\t}\n\n\tthis.getControl = (/*name,*/ options = {}) => {\n\t\t// if (typeof options === 'string') {\n\t\t// \tthrow new Error('VirtualJoystick accepts options object');\n\t\t// }\n\t\tconst read = () => {\n\t\t\treturn startEvent ?\n\t\t\t\t[deltaX, deltaY] :\n\t\t\t\tStickInputControl.defaultValue;\n\t\t};\n\n\t\treturn new StickInputControl(read, Object.assign(\n\t\t\t{},\n\t\t\toptions,\n\t\t\t{ device: this }\n\t\t));\n\t};\n\n\tthis.destroy = () => {\n\t\tif (touchActionStyle) {\n\t\t\t// todo: only if it wasn't set before\n\t\t\tstyleElement.style.touchAction = '';\n\t\t}\n\n\t\telement.removeEventListener('pointerdown', pointerDown);\n\t\telement.removeEventListener('pointermove', pointerMove);\n\t\telement.removeEventListener('pointerup', pointerUp);\n\t\telement.removeEventListener('pointercancel', pointerUp);\n\t};\n\n\tObject.defineProperties(this, {\n\t\tpointerType: {\n\t\t\tget: () => lastEvent && lastEvent.pointerType || ''\n\t\t},\n\n\t\tconnected: {\n\t\t\tenumerable: false,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tvalue: supported\n\t\t},\n\n\t\ttimestamp: {\n\t\t\tget: () => lastEvent && lastEvent.timeStamp || 0\n\t\t},\n\n\t\telement: {\n\t\t\tenumerable: false,\n\t\t\tconfigurable: false,\n\t\t\twritable: false,\n\t\t\tvalue: element\n\t\t},\n\n\t\tx: {\n\t\t\tget: () => isStatic ? x : startX,\n\t\t\tset: val => {\n\t\t\t\tx = val;\n\t\t\t}\n\t\t},\n\n\t\ty: {\n\t\t\tget: () => isStatic ? y : startY,\n\t\t\tset: val => {\n\t\t\t\ty = val;\n\t\t\t}\n\t\t},\n\n\t\tradius: {\n\t\t\tget: () => radius,\n\t\t\tset: val => {\n\t\t\t\tradius = val;\n\t\t\t}\n\t\t}\n\t});\n\n\tif (supported) {\n\t\telement.addEventListener('pointerdown', pointerDown);\n\t\telement.addEventListener('pointermove', pointerMove);\n\t\telement.addEventListener('pointerup', pointerUp);\n\t\telement.addEventListener('pointercancel', pointerUp);\n\t}\n}\n","export default function domView(control, options = {}) {\n\tconst { device } = control;\n\tconst {\n\t\tinnerRadius = Math.max(24, device.radius / 4),\n\t\tparentElement = document.body\n\t} = options;\n\n\tconst outer = document.createElement('div');\n\tObject.assign(outer.style, {\n\t\tposition: 'fixed',\n\t\tpointerEvents: 'none',\n\t\tborderRadius: 999e20 + 'px',\n\n\t\ttransition: 'opacity 0.1s',\n\n\t\t//temp\n\t\tbackgroundColor: 'rgba(128, 128, 128, 0.5)'\n\t});\n\n\tconst inner = document.createElement('div');\n\tObject.assign(inner.style, {\n\t\tposition: 'fixed',\n\t\tpointerEvents: 'none',\n\t\tborderRadius: 999e20 + 'px',\n\n\t\ttransition: 'opacity 0.1s',\n\n\t\t//temp\n\t\tbackgroundColor: 'rgba(128, 128, 128, 0.5)'\n\t});\n\touter.appendChild(inner);\n\n\tlet rafId = 0;\n\n\tfunction render() {\n\t\tconst [x, y] = control.read();\n\n\t\tif (control.mode === 'static' || x || y) {\n\t\t\tconst outerSize = device.radius * 2;\n\t\t\tconst ox = device.x - device.radius;\n\t\t\tconst oy = device.y - device.radius;\n\n\t\t\touter.style.left = ox + 'px';\n\t\t\touter.style.top = oy + 'px';\n\t\t\touter.style.width = outer.style.height = outerSize + 'px';\n\t\t\touter.style.opacity = 1;\n\n\t\t\tconst innerSize = innerRadius * 2;\n\n\t\t\tinner.style.left = device.x + x * device.radius - innerRadius + 'px';\n\t\t\tinner.style.top = device.y - y * device.radius - innerRadius + 'px';\n\t\t\tinner.style.width = inner.style.height = innerSize + 'px';\n\t\t\tinner.style.opacity = 1;\n\t\t} else {\n\t\t\touter.style.opacity = 0;\n\t\t\tinner.style.opacity = 0;\n\t\t}\n\n\t\trafId = requestAnimationFrame(render);\n\t}\n\n\tparentElement.appendChild(outer);\n\n\trafId = requestAnimationFrame(render);\n\n\treturn {\n\t\tdestroy: () => {\n\t\t\tcancelAnimationFrame(rafId);\n\n\t\t\tif (outer.parentNode) {\n\t\t\t\touter.parentNode.removeChild(outer);\n\t\t\t}\n\t\t}\n\t};\n}\n","import Gamepad from '../src/devices/gamepad';\nimport Keyboard from '../src/devices/keyboard';\nimport Pointer from '../src/devices/pointer';\nimport DPadComposite from '../src/controls/DPadComposite';\nimport AxisComposite from '../src/controls/AxisComposite';\nimport Action from '../src/Action';\nimport PressInteraction from '../src/interactions/PressInteraction';\nimport ReleaseInteraction from '../src/interactions/ReleaseInteraction';\nimport VirtualJoystick from '../src/devices/virtualjoystick';\nimport domView from '../src/devices/virtualjoystick/domView';\n\nconst gamepad = new Gamepad();\nconst leftStick = gamepad.getControl('leftStick');\n// const downButton = leftStick.find('down');\nconst rightStickHoriz = gamepad.getControl('rightStick').find('x');\n\nconst kbd = new Keyboard();\nconst kbdWASD = new DPadComposite({\n\tup: kbd.getControl('W'),\n\tleft: kbd.getControl('A'),\n\tdown: kbd.getControl('S'),\n\tright: kbd.getControl('D')\n});\n\nconst pointer = new Pointer({\n\ttouch: false\n});\n\nconst rotateArrowKeys = new AxisComposite({\n\tnegative: kbd.getControl('arrowleft'),\n\tpositive: kbd.getControl('arrowright')\n});\n\nconst leftTouchJoystick = new VirtualJoystick({\n\tfilter: evt => evt.pageX < Math.max(200, window.innerWidth * 0.4)\n}).getControl();\n\n\nconst rightTouchJoystick = new VirtualJoystick({\n\tfilter: evt => evt.pageX > window.innerWidth - Math.max(200, window.innerWidth * 0.4)\n}).getControl();\n\nconst moveAction = new Action({\n\tbindings: [\n\t\tleftStick,\n\t\tkbdWASD,\n\t\tleftTouchJoystick,\n\t\t{\n\t\t\tcontrol: pointer.getControl('delta'),\n\t\t\tprocessors: [\n\t\t\t\tvec => [\n\t\t\t\t\tvec[0] / 8,\n\t\t\t\t\t-vec[1] / 8\n\t\t\t\t]\n\t\t\t]\n\t\t}\n\t]\n});\nconst rotateAction = new Action({\n\tbindings: [\n\t\trightStickHoriz,\n\t\trotateArrowKeys,\n\t\trightTouchJoystick.find('x'),\n\t\tpointer.getControl('wheel')\n\t]\n});\n\nconst buttonAction = new Action({\n\tbindings: [kbd.getControl(' ')],\n\tinteractions: [\n\t\tnew PressInteraction(),\n\t\tnew ReleaseInteraction()\n\t]\n});\n// buttonAction.on('press', () => console.log('spacebar down'));\n// buttonAction.on('release', () => console.log('spacebar up'));\nbuttonAction.on('completed', binding => console.log('interaction', binding));\n\nconst thing = document.createElement('div');\nObject.assign(thing.style, {\n\tposition: 'absolute',\n\twidth: '30px',\n\theight: '60px',\n\tbackgroundColor: 'rebeccapurple',\n\tmargin: '-15px 30px'\n});\ndocument.body.appendChild(thing);\n\nconst speed = 300 / 1000; // pixels per 1000ms\nconst rotSpeed = 360 / 1000; // degrees per 1000ms\nlet x = 100;\nlet y = 100;\nlet r = 30;\n\nlet last = performance.now();\nfunction update(t = performance.now()) {\n\tconst delta = t - last;\n\tlast = t;\n\n\tmoveAction.update();\n\trotateAction.update();\n\tbuttonAction.update();\n\n\tconst [dx, dy] = moveAction.value;\n\tconst dr = rotateAction.value;\n\n\tconst motionScale = speed * delta;\n\tx += dx * motionScale;\n\ty -= dy * motionScale;\n\n\tr += dr * rotSpeed * delta;\n\n\t// render\n\tthing.style.transform = `translate(${x}px, ${y}px) rotate(${r}deg)`;\n\trequestAnimationFrame(update);\n}\n\ndomView(leftTouchJoystick);\ndomView(rightTouchJoystick);\n\nupdate();\n","import ButtonInputControl from '../../controls/ButtonInputControl';\nimport boolAsNum from '../../util/boolAsNum';\n\nexport default function Keyboard() {\n\tconst keysDown = new Set();\n\n\tconst onKeyDown = evt => {\n\t\tkeysDown.add(evt.key.toLowerCase());\n\t};\n\tconst onKeyUp = evt => {\n\t\tkeysDown.delete(evt.key.toLowerCase());\n\t};\n\n\tfunction readAnyKey() {\n\t\treturn keysDown.size > 0;\n\t}\n\n\tfunction readSingleKey(key) {\n\t\treturn keysDown.has(key.toLowerCase());\n\t}\n\n\tfunction readFilterKey(filter) {\n\t\treturn readAnyKey() && filter(new Set(keysDown));\n\t}\n\n\tfunction readArrayKey(keys) {\n\t\treturn keys.some(readSingleKey);\n\t}\n\n\tthis.getControl = (name, options = {}) => {\n\t\tconst {\n\t\t\tfilter = name,\n\t\t\t...opts\n\t\t} = options;\n\n\t\tlet read = readAnyKey;\n\t\tif (filter) {\n\t\t\tif (typeof filter === 'string') {\n\t\t\t\tread = () => readSingleKey(filter);\n\t\t\t} else if (typeof filter === 'function') {\n\t\t\t\tread = () => readFilterKey(filter);\n\t\t\t} else if (Array.isArray(filter)) {\n\t\t\t\tread = () => readArrayKey(filter);\n\t\t\t}\n\t\t}\n\n\t\treturn new ButtonInputControl(boolAsNum(read), Object.assign({\n\t\t\tname: typeof name === 'string' && options.filter ?\n\t\t\t\tname :\n\t\t\t\ttypeof filter === 'string' ?\n\t\t\t\t\t`key:${filter}` :\n\t\t\t\t\tString(name || filter)\n\t\t}, opts));\n\t};\n\n\tthis.destroy = () => {\n\t\tkeysDown.clear();\n\t\twindow.removeEventListener('keydown', onKeyDown);\n\t\twindow.removeEventListener('keyup', onKeyUp);\n\t};\n\n\t// assume keyboard is always connected\n\tObject.defineProperty(this, 'connected', {\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t\twritable: false,\n\t\tvalue: true\n\t});\n\n\twindow.addEventListener('keydown', onKeyDown);\n\twindow.addEventListener('keyup', onKeyUp);\n}\n"],"sourceRoot":""}